# ì¡°íšŒí•œ ë¹ˆì´ ëª¨ë‘ í•„ìš”í•  ë•Œ_ì „ëµ íŒ¨í„´

Discount Policy ë¥¼ ì˜ˆë¡œë“¤ì–´

í´ë¼ì´ì–¸íŠ¸ê°€ í• ì¸ ë°©ë²•ì„ ì„ íƒí•  ìˆ˜ ìˆê²Œ êµ¬í˜„í•˜ê³  ì‹¶ì€ê²½ìš°

- Rate Discount Policy
- Fix Discount Policy

ìŠ¤í”„ë§ì„ ì‚¬ìš©í•´ ì´ëŸ¬í•œ ì „ëµ íŒ¨í„´ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

<br>

## âœï¸Â List ì™€ Map ìœ¼ë¡œ Discount Policy ì˜ êµ¬í˜„ì²´ í•œë²ˆì— ì¡°íšŒí•˜ê¸°

- í…ŒìŠ¤íŠ¸ìš© Class ìƒì„±í›„ ì œë„¤ë¦­ì— ì¡°íšŒë¥¼ ì›í•˜ëŠ” interface ì¸ Discount Policy ë¥¼ ê°’ìœ¼ë¡œ ë„£ì–´ì¤€ë‹¤.

```java
package hello.core.autowired;

import hello.core.discount.DiscountPolicy;
import org.junit.jupiter.api.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Configuration;

import java.util.List;
import java.util.Map;

public class AllBeanTest {

    @Configuration
    static class DiscountService {
				// Mpa ì´ìš©í•œ ì¡°íšŒ
        private final Map<String, DiscountPolicy> policyMap;
				// List ë¥¼ ì´ìš©í•œ ì¡°íšŒ
        private final List<DiscountPolicy> policyList;

				// ê°’ì„ ì£¼ì… ë°›ê¸°ìœ„í•œ ìƒì„±ì
				@Autowired
        public DiscountService(Map<String, DiscountPolicy> policyMap, List<DiscountPolicy> policyList) {
            this.policyMap = policyMap;
            this.policyList = policyList;
						// í•„ë“œê°’ ì¡°íšŒ
            System.out.println("policyMap = " + policyMap);
            System.out.println("policyList = " + policyList);
        }
    }

    @Test
    void findAllBean () {
        ApplicationContext ac = new AnnotationConfigApplicationContext(DiscountService.class);
    }
}
```

- ì´ë ‡ê²Œ ì‹¤í–‰í•˜ë©´ DiscountPolicy ë§Œ ë“±ë¡ë˜ê³  í•„ë“œì— ì£¼ì…ëœê²ƒì´ ì—†ì–´ ì•„ë¬´ê°’ë„ ë‚˜ì˜¤ì§€ ì•ŠëŠ”ë‹¤.
    - ì´ì „ì— ë§Œë“¤ì–´ë‘ì—ˆë˜ AutoAppConfig ì—ì„œ ì£¼ì…í•´ì¤„ Bean ì„ ì£¼ì…í•˜ë©´ ëœë‹¤.

```java
		@Test
    void findAllBean () {
        ApplicationContext ac = 
						new AnnotationConfigApplicationContext(
								AutoAppConfig.class , DiscountService.class
						);
    }
```

ğŸ”Â ì¶œë ¥ê°’

- DiscountPolicy ì˜ êµ¬í˜„ì²´ì¸ fix ì™€ rate ê°€ map ê³¼ list ì— ì˜ ë‹´ê²¼ë‹¤.

```java
policyMap = {
			fixDiscountPolicy=hello.core.discount.FixDiscountPolicy@5c153b9e,
			rateDiscountPolicy=hello.core.discount.RateDiscountPolicy@2a7686a7
}
policyList = [
			hello.core.discount.FixDiscountPolicy@5c153b9e, 
			hello.core.discount.RateDiscountPolicy@2a7686a7
]
```

<br>

## âœï¸Â ì „ëµ íŒ¨í„´ ë§Œë“¤ê¸° : í´ë¼ì´ì–¸íŠ¸ê°€ ì„ íƒí•˜ëŠ” í• ì¸ ì •ì±…

```java
package hello.core.autowired;

import hello.core.AutoAppConfig;
import hello.core.discount.DiscountPolicy;
import hello.core.member.Grade;
import hello.core.member.Member;
import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Configuration;

import java.util.List;
import java.util.Map;

import static org.assertj.core.api.Assertions.assertThat;

public class AllBeanTest {

    @Configuration
    static class DiscountService {
        private final Map<String, DiscountPolicy> policyMap;
        private final List<DiscountPolicy> policyList;

        @Autowired
        public DiscountService(Map<String, DiscountPolicy> policyMap, List<DiscountPolicy> policyList) {
						// Map ì— DiscountPolicy ì˜ ëª¨ë“  êµ¬í˜„ì²´ë¥¼ ì£¼ì…
            this.policyMap = policyMap;
            this.policyList = policyList;
            System.out.println("policyMap = " + policyMap);
            System.out.println("policyList = " + policyList);
        }
				// dicount êµ¬í˜„ Method
        public int discount(Member member, int price, String discountCode) {
						// Map ì— ë‹´ê¸´ êµ¬í˜„ì²´ë¥¼ discountCode ë¡œ get í•´ì„œ êµ¬í˜„ì²´ ì£¼ì…
            DiscountPolicy discountPolicy = policyMap.get(discountCode);
						// ì£¼ì…í•œ êµ¬í˜„ì²´ ë¡œì§ìœ¼ë¡œ í• ì¸ ê¸ˆì•¡ return
            return discountPolicy.discount(member , price);
        }
    }

    @Test
    void findAllBean () {
        ApplicationContext ac = new AnnotationConfigApplicationContext(AutoAppConfig.class , DiscountService.class);
        DiscountService discountService = ac.getBean(DiscountService.class);
				// Member ìƒì„±
        Member member = new Member(1L, "UserA", Grade.VIP);
        // discount method ë¡œ í• ì¸ëœ ê°€ê²© ìƒì„±
				// discount ( í´ë¼ì´ì–¸íŠ¸ ì´ë¦„ , êµ¬ì… ê°€ê²© , ì›í•˜ëŠ” í• ì¸ ì •ì±…ì˜ Key ê°’ );
				// ë§µì— ë‹´ê¸´ êµ¬í˜„ì²´ì˜ ì œë„¤ë¦­ì´ <String , DiscountPolicy> ê¸° ë•Œë¬¸ì— String íƒ€ì…ìœ¼ë¡œ ì ì–´ì¤€ë‹¤.
        int discountPrice = discountService.discount(member, 20000, "rateDiscountPolicy");

        assertThat(discountService).isInstanceOf(DiscountService.class);
        assertThat(discountPrice).isEqualTo(2000);
    }
}
```

## ğŸ”Â ë¡œì§ ë¶„ì„

### ğŸ“Â Config Class

- Map ì— DiscountPolicy ì˜ ëª¨ë“  êµ¬í˜„ì²´ë¥¼ ì£¼ì…
    - key ê°’ìœ¼ë¡œ êµ¬í˜„ì²´ ì´ë¦„ì„ ì…ë ¥í•˜ë©´ value ê°’ìœ¼ë¡œ í•´ë‹¹ êµ¬í˜„ì²´ê°€ ë‚˜ì˜¨ë‹¤.
- discount Method ë¥¼ êµ¬í˜„í•œë‹¤
    - discount ( ì´ë¦„ , êµ¬ì…ê°€ê²© , ì›í•˜ëŠ” í• ì¸ì •ì±… )
    - key ê°’ì´ String íƒ€ì…ì´ë¼ ì›í•˜ëŠ” í• ì¸ ì •ì±…ë„ String íƒ€ì…ì´ì—¬ì•¼ í•œë‹¤.
    - Map ì—ì„œ argument ë¥¼ ë°›ì•„ì™€ get í•˜ê³  DiscountPolicy ì˜ êµ¬í˜„ì²´ë¡œ ì£¼ì…ì‹œí‚¨ë‹¤.
    - êµ¬í˜„ì²´ì˜ discount Method ì—ì„œ í• ì¸ëœ ê°’ì„ return ë°›ëŠ”ë‹¤.

### ğŸ“Â ì‹¤í–‰ Method

- Config ë¥¼ ìƒì„±í•´ì„œ Bean ì„ get í•œë‹¤.
- Member ë¥¼ ìƒì„±í•˜ê³  discount Method ë¥¼ í˜¸ì¶œí•œë‹¤.
    - discount ì˜ parameter ê°’ì„ ì˜ ì…ë ¥í•´ì¤€ë‹¤.
    - parameter ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ í• ì¸ëœ ê°€ê²©ì´ return ëœë‹¤.