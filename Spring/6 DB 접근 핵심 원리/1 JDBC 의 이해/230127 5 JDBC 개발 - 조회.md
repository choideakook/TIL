# JDBC ê°œë°œ - ì¡°íšŒ

## âœï¸Â ResultSet

- ì°¨íŠ¸ í˜•íƒœì˜ êµ¬ì¡°ë¥¼ ê°€ì§„ data type ì´ë‹¤.
- êµ¬ì¡°ì  íŠ¹ì§•ì„ ì´ìš©í•´ DB ì˜ ì‘ë‹µì„ ë‹´ì„ ìˆ˜ ìˆë‹¤.
- ìì²´ì ìœ¼ë¡œ cursor ë¥¼ ê°–ê³  ìˆëŠ”ë° ê¸°ë³¸ì ìœ¼ë¡œ ì•„ë¬´ê²ƒë„ ê°€ë¦¬í‚¤ê³  ìˆì§€ì•Šë‹¤.
- rs.next() ë¥¼ ì‚¬ìš©í•˜ë©´ ì²«ë²ˆì§¸ row ë¡œ ì»¤ì„œê°€ ì´ë™í•˜ê³  ì»¤ì„œê°€ ê°€ë¦¬í‚¤ëŠ” data ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œëœë‹¤.
    - ì»¤ì„œë¥¼ ì˜®ê¸°ê³  true ë¥¼ ë°˜í™˜í•œë‹¤.
- rs.next() í•œë²ˆ ë” í˜¸ì¶œí•˜ë©´ ì»¤ì„œëŠ” ë‹¤ìŒ row ë¡œ ì´ë™í•˜ê³  ì´ëŸ°ì‹ìœ¼ë¡œ ëª¨ë“  row ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.
- ë§ˆì§€ë§‰ row ì—ì„œ rs.next() ë¥¼ ì‚¬ìš©í•˜ê²Œë˜ë©´ false ë¥¼ ë°˜í™˜í•˜ê²Œ ëœë‹¤.

<img width="530" alt="s616" src="https://user-images.githubusercontent.com/115536240/215238977-4fd1c9a1-14fc-476c-bf44-639686aa100e.png">


<br>

## âœï¸Â Find by id

- data ë¥¼ ì¡°íšŒí•  ë• pstmt.executeQuery() ë¥¼ ì‚¬ìš©í•œë‹¤.
    - ê²°ê³¼ë¥¼ í™•ì¸í•´ì•¼ í•˜ë¯€ë¡œ rs ì— ë³€ìˆ˜ë¡œ ë‹´ì•„ì¤€ë‹¤.

```java
   public Member findById(String memberId) throws SQLException {
        //ë¦¬ì†ŒìŠ¤ ìƒì„±
        String sql = "select * from member where member_id = ?";
        Connection con = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;

        try {
            // Connection íšë“, SQL ìƒì„±
            con = DBConnectionUtil.getConnection();
            pstmt = con.prepareStatement(sql);
            pstmt.setString(1, memberId);
            // data ì¡°íšŒ, rs ì— ê²°ê³¼ ë‹´ê¸°
            rs = pstmt.executeQuery();

            // rs ê²°ê³¼ í™•ì¸
            // í•˜ë‚˜ì˜ id ë¥¼ íŠ¹ì •í•´ í•˜ë‚˜ì˜ data ë§Œ ì¡°íšŒí•˜ê¸° ë•Œë¬¸ì—
            // ë°˜ë³µë¬¸ì´ ì•„ë‹Œ if ë¬¸ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
            if (rs.next()) {
                Member member = new Member();
                member.setMemberId(rs.getString("member_id"));
                member.setMoney(rs.getInt("momey"));
                return member;
            } else {
                // ì˜ˆì™¸ throw
                throw new NoSuchElementException("member not found memberId = " + memberId);
            }

        } catch (SQLException e) {
            // ì˜ˆì™¸ì‹œ ë¡œê·¸ ë‚¨ê¸°ê³  ì—ëŸ¬ ë°–ìœ¼ë¡œ throw
            log.error("db error", e);
            throw e;
        }finally {
            // Connection close
            close(con, pstmt, rs);
        }
    }
```

<br>

## âœï¸Â Test

- test ê°€ ì •ì„±ì ìœ¼ë¡œ ì‘ë™ ë˜ì—ˆë‹¤.

```java
@Slf4j
class MemberRepositoryV0Test {

    MemberRepositoryV0 repository = new MemberRepositoryV0();

    @Test
    void crud() throws SQLException {
        // save
        Member member = new Member("memberV2", 10000);
        repository.save(member);

        // find by id
        Member findMember = repository.findById(member.getMemberId());
        log.info("findMember = {}", findMember);
        assertThat(findMember).isEqualTo(member);
    }

}
```

<br>

### ğŸ”Â ì¶œë ¥ë¬¼ í™•ì¸

- ë°©ê¸ˆ ë“±ë¡í•œ member ì˜ id ë¡œ ì¡°íšŒí•œ ë‚´ìš©ì´ ë¡œê·¸ë¥¼ í†µí•´ ì¶œë ¥ ë˜ì—ˆë‹¤.
- findMember ê°€ ì°¸ì¡°ê°’ì´ ì•„ë‹ˆë¼ í•„ë“œê°’ì´ ì¶œë ¥ëœ ì´ìœ ëŠ” Member ì˜ @Data ì— toString ì´ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

```java
17:31:43.328 [main] INFO hello.jdbc.repository.MemberRepositoryV0Test 
    - findMember = Member(memberId=memberV2, money=10000)
```
