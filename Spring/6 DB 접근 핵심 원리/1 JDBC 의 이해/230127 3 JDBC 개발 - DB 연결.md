# JDBC ê°œë°œ - DB ì—°ê²°

application ê³¼ DB ì—°ê²°

## âœï¸Â Connetion ìƒìˆ˜ ìƒì„±

- DB ì ‘ì†ì— í•„ìš”í•œ ê¸°ë³¸ ì •ë³´ë“¤ì„ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ìƒìˆ˜ë¡œ ìƒì„±í•œë‹¤.
- abstract class ë¡œ ìƒì„±í•´ì•¼ í•œë‹¤.

```java
package hello.jdbc.connection;

public abstract class ConnectionConst {

    public static final String URL = "jdbc:h2:tcp://localhost/~/jdbc";
    public static final String USERNAME = "sa";
    public static final String PASSWORD = "";
}
```

<br>

## âœï¸Â DB Connection Util

JDBC ë¥¼ ì‚¬ìš©í•´ ì‹¤ì§ˆì ì¸ DB ì—°ê²°í•˜ëŠ” ì½”ë“œë¥¼ ìƒì„±

- DriverManager ë¥¼ ì‚¬ìš©í•´ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ìˆëŠ” DB ë“œë¼ì´ë²„ë¥¼ ì°¾ì•„ì„œ í•´ë‹¹ ë“œë¼ì´ë²„ê°€ ì¬ê³µí•˜ëŠ” ì»¤ë„¥ì…˜ì„ ë°˜í™˜í•´ì•¼í•œë‹¤.
- getConnection ì˜ argument ëŠ” Connection ìƒìˆ˜ì˜ static ë³€ìˆ˜ ì¸ë° static import ë¡œ Class ëª…ì„ ìƒëµí•´ì£¼ì—ˆë‹¤.
- @Slf4j ëŠ” log ë¥¼ ìë™ìœ¼ë¡œ ë‚¨ê²¨ì£¼ëŠ” ì–´ë…¸í…Œì´ì…˜ì´ë‹¤.

```java
package hello.jdbc.connection;

import lombok.extern.slf4j.Slf4j;

import java.sql.Connection;
import java.sql.DriverManager;

import static hello.jdbc.connection.ConnectionConst.*;

@Slf4j // ë¡œê·¸ë¥¼ ë‚¨ê²¨ì£¼ëŠ” ì–´ë…¸í…Œì´ì…˜
public class DBConnectionUtil {

    // java.sql.connection ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
    // JDBC í‘œì¤€ ì¸í„°í˜ì´ìŠ¤
    public static Connection getConnection() {
        DriverManager.getConnection(URL, USERNAME, PASSWORD);
    }
}
```

- getConnection ì„ O + E ë¡œ Try / Catch í˜•íƒœë¡œ ë³€ê²½

```java
package hello.jdbc.connection;

import lombok.extern.slf4j.Slf4j;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

import static hello.jdbc.connection.ConnectionConst.*;

@Slf4j
public class DBConnectionUtil {

    public static Connection getConnection() {
        try {
            DriverManager.getConnection(URL, USERNAME, PASSWORD);
        } catch (SQLException e) {
            throw new RuntimeException(e);
        }
    }
}
```

- @Slf4j ì˜ ë¡œê·¸ ì •ë³´ ì–‘ì‹ì„ log.info ì— ë§Œë“¤ì–´ì¤€ë‹¤.
    - method ì‹¤í–‰ì‹œ ì–‘ì‹ëŒ€ë¡œ ë¡œê·¸ê°€ ì¶œë ¥ëœë‹¤.
- ë“œë¼ì´ë²„ê°€ ì œê³µí•˜ëŠ” ì»¤ë„¥ì…˜ì„ ë°˜í™˜ì‹œì¼œì¤€ë‹¤.
    - ì—¬ê¸°ì„œëŠ” H2 DB ì˜ ë“œë¼ì´ë²„ê°€ ì‘ë™í•´ ì‹¤ì œ DB ì™€ ì»¤ë„¥ì…˜ì„ ë§ºê³  ë°˜í™˜ë˜ê²Œ ëœë‹¤.

```java
package hello.jdbc.connection;

import lombok.extern.slf4j.Slf4j;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

import static hello.jdbc.connection.ConnectionConst.*;

@Slf4j
public class DBConnectionUtil {

    // JDBC ë¥¼ ì‚¬ìš©í•œ DB ì—°ê²° Method
    public static Connection getConnection() {
        try {
            Connection connection = DriverManager.getConnection(URL, USERNAME, PASSWORD);
            log.info("get connection={}, class={}", connection, connection.getClass());
            return connection;
        } catch (SQLException e) {
            throw new IllegalStateException(e);
        }
    }
}
```

<br>

## âœï¸Â ì—°ê²° ê²°ê³¼ í™•ì¸í•˜ê¸°

DBConnectionUtil ì˜ Test Class ìƒì„± í›„ getConnection ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•´ ì—°ê²°ì´ ì˜ ë˜ì—ˆëŠ”ì§€ ê²€ì¦í•œë‹¤.

- ì„±ê³µí•˜ë©´ ì—°ê²° ì„±ê³µ

```java
package hello.jdbc.connection;

import lombok.extern.slf4j.Slf4j;
import org.junit.jupiter.api.Test;

import java.sql.Connection;

import static org.assertj.core.api.Assertions.assertThat;

@Slf4j
public class DBConnectionUtilTest {

    @Test
    void connection() {
        Connection connection = DBConnectionUtil.getConnection();
        assertThat(connection).isNotNull();
    }
}
```

<br>

### ğŸ”Â ì¶œë ¥ë¬¼ í™•ì¸

- @Slf4j ì–´ë…¸í…Œì´ì…˜ì´ ë‚¨ê¸´ ë¡œê·¸ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.
- ìƒìˆ˜ë¡œ ë§Œë“¤ì–´ë‘ì—ˆë˜ ì •ë³´ëŒ€ë¡œ ì—°ê²°ì´ ì˜ ëœê±¸ ì¶œë ¥ë¬¼ì„ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```java
14:03:23.250 [main] INFO hello.jdbc.connection.DBConnectionUtil
    - get connection=conn0: 
    url=jdbc:h2:tcp://localhost/~/jdbc
    user=SA,
    class=class org.h2.jdbc.JdbcConnection  // H2 ì „ìš© ë“œë¼ì´ë²„
```

<br>

### âœï¸Â ì‘ë™ ì›ë¦¬

1. Connetion ìƒìˆ˜ë¥¼ ìƒì„±í•´ JDBC í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ì— ë§ê²Œ ì…ë ¥í•  ì •ë³´ë¥¼ ìƒì„±í•œë‹¤.
2. getConnection ë©”ì†Œë“œê°€ ì‹¤í–‰ë˜ë©´ DriverManager ê°€ ìƒìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Connetion ì„ ìƒì„±í•œë‹¤.
    - ì´ë•Œ Connetion ì€ interface ì´ê¸° ë•Œë¬¸ì— êµ¬í˜„ì²´ê°€ í•„ìš”í•˜ë‹¤.
3. êµ¬ì²´í™”ëŠ” ê´€ê³„í˜• DB (H2) ì™€ ì—°ê²°í•˜ê¸°ìœ„í•œ ë“œë¼ì´ë²„ê°€ í•˜ê²Œëœë‹¤.
    - class org.h2.jdbc.JdbcConnection
4. DriverManager ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ë“±ë¡ëœ ë“œë¼ì´ë²„ë“¤ì„ ìë™ìœ¼ë¡œ ì¸ì‹í•´ í•˜ë‚˜ í•˜ë‚˜ connetion ì„ ìš”ì²­í•˜ê³  URL ì´ ê°™ì€ê²½ìš° connetion ì„ íšë“¤ í•  ìˆ˜ ìˆê²Œëœë‹¤.
5. conntion ì„ íšë“í•œë’¤ connection êµ¬í˜„ì²´ë¥¼ í´ë¼ì´ì–¸íŠ¸ì— return í•˜ë©´ DB ì™€ ì—°ê²°ì´ ì™„ë£Œëœë‹¤.

### â—ï¸ H2 DB ì—°ê²°ì¤‘ì´ì§€ ì•Šìœ¼ë©´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

ì´ëŸ¬í•œ ì—ëŸ¬ê°€ ë°œìƒë ê²½ìš° DB ê°€ ì¢…ë£Œë¬ëŠ”ì§€ í™•ì¸í•´ë³´ì.

```java
Connection is broken: "java.net.ConnectException: Connection refused
  (Connection refused): localhost" [90067-200]
```