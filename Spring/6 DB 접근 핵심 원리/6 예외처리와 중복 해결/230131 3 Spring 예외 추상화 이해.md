# Spring ì˜ˆì™¸ ì¶”ìƒí™” ì´í•´

Spring ì€ ì•ì˜ ë¬¸ì œë“¤ì„ í•´ê²°í•˜ê¸° ìœ„í•´ Data ì ‘ê·¼ê³¼ ê´€ë ¨ëœ ì˜ˆì™¸ë¥¼ ì¶”ìƒí™”í•´ì„œ ì œê³µí•œë‹¤.

- Spring ì€ data ì ‘ê·¼ ê³„ì¸µì— ëŒ€í•œ ìˆ˜ ë§ì€ ì˜ˆì™¸ë¥¼ ì •ë¦¬í•´ ì¼ê´€ëœ ì˜ˆì™¸ ê³„ì¸µì„ ì œê³µí•œë‹¤.
- ê°ê°ì˜ ì˜ˆì™¸ëŠ” íŠ¹ì • ê¸°ìˆ ì— ì¢…ì†ì ì´ì§€ ì•Šê²Œ ì„¤ê³„ë˜ì—ˆë‹¤.
- JDBC ë‚˜ JPA ë¥¼ ì‚¬ìš©í•  ë•Œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ë¥¼ Spring ì´ ì œê³µí•˜ëŠ” ì˜ˆì™¸ë¡œ ë³€í™˜í•´ì£¼ëŠ” ì—­í• ë„ Spring ì´ ì œê³µí•œë‹¤.

<br>

![s6631.png](Spring%20%E1%84%8B%E1%85%A8%E1%84%8B%E1%85%AC%20%E1%84%8E%E1%85%AE%E1%84%89%E1%85%A1%E1%86%BC%E1%84%92%E1%85%AA%20%E1%84%8B%E1%85%B5%E1%84%92%E1%85%A2%2041f4c2c67e9f4e6489a33edbeec4af3a/s6631.png)

[ğŸ”—Â ì˜ˆì™¸ì˜ ì „ì²´ ê³„ì¸µ](https://github.com/choideakook/TIL/blob/main/Spring/6%20DB%20ì ‘ê·¼%20í•µì‹¬%20ì›ë¦¬/5%20Java%20ì˜%20Exception/230131%201%20Java%20ì˜%20ì˜ˆì™¸.md)

- Runtime Exception
    - ì˜ˆì™¸ì˜ ìµœìƒìœ„ ê°ì²´ ì´ë‹¤.
    - Spring ì´ ì œê³µí•˜ëŠ” data ì ‘ê·¼ ê³„ì¸µì˜ ëª¨ë“  ì˜ˆì™¸ë„ Runtime ì˜ˆì™¸ê°€ ëœë‹¤.
- Data Access Exception
    - NonTransient ì™€ Transient ì˜ˆì™¸ ë‘ê°€ì§€ë¡œ ë‚˜ë‰œë‹¤.
- Transient
    - ì¼ì‹œì  ì´ë¼ëŠ” ëœ»ì´ë‹¤.
    - ë™ì¼í•œ SQL ì„ ì¬ì‹œë„ í• ê²½ìš° ì„±ê³µí•  ê°€ëŠ¥ì„±ì´ ìˆëŠ” ì˜ˆì™¸ì´ë‹¤.
    - DB ìƒíƒœì˜ ë¬¸ì œë‚˜, Lock ë¬¸ì œ ë“±ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ì´ë‹¤.
- NonTransient
    - ì¼ì‹œì ì´ì§€ ì•Šë‹¤ëŠ” ëœ»ì´ë‹¤.
    - ë™ì¼í•œ SQL ì„ ì•„ë¬´ë¦¬ ë°˜ë³µí•´ë„ ì„±ê³µí•˜ì§€ ëª»í•˜ê³  ì‹¤íŒ¨í•œë‹¤.
    - SQL ë¬¸ë²• ì˜¤ë¥˜, DB ì œì•½ ì¡°ê±´ ìœ„ë°° ë“±ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ì´ë‹¤.

<br>

## âœï¸Â Spring ì´ ì œê³µí•˜ëŠ” ì˜ˆì™¸ ë³€í™˜ê¸°

Spring ì€ DB ì—ì„œ ë°œìƒí•˜ëŠ” error code ë¥¼ ì§ì ‘ ì •ì˜í•œ ì˜ˆì™¸ë¡œ ìë™ ë³€í™˜í•´ì£¼ëŠ” ë³€í™˜ê¸°ë¥¼ ì œê³µí•œë‹¤.

- ë³„ë„ë¡œ ë³€í™˜í•˜ëŠ” ë¡œì§ì—†ì´ ë³€í™˜ê¸°ë¥¼ ì´ìš©í•´ SQLException ì„ Spring ì´ ì œê³µí•˜ëŠ” Exception ìœ¼ë¡œ ë³€í™˜ì— ì„±ê³µí–ˆë‹¤.
    - ë¬¸ë²• ì˜ˆì™¸ê°€ ë°œìƒí–ˆê¸° ë•Œë¬¸ì— BadSqlGrammarException ë¡œ ë³€í™˜ë¨

```java
package hello.jdbc.excepiton.translator;

import lombok.extern.slf4j.Slf4j;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.dao.DataAccessException;
import org.springframework.jdbc.BadSqlGrammarException;
import org.springframework.jdbc.datasource.DriverManagerDataSource;
import org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator;
import javax.sql.DataSource;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;

import static hello.jdbc.connection.ConnectionConst.*;
import static org.assertj.core.api.Assertions.assertThat;

@Slf4j
public class SpringExceptionTranslatorTest {

    DataSource dataSource;

    @BeforeEach
    void init() {
        dataSource = new DriverManagerDataSource(URL, USERNAME, PASSWORD);
    }

    @Test
    void exceptionTranslator() {
        String sql = "bad SQL grammar";

        try {
            Connection con = dataSource.getConnection();
            PreparedStatement stmt = con.prepareStatement(sql);
            stmt.executeQuery();
        } catch (SQLException e) {
            // ê²€ì¦
            // H2 ì˜ SQL ë¬¸ë²• ì—ëŸ¬ì½”ë“œëŠ” 42001 ì´ë‹¤.
            assertThat(e.getErrorCode()).isEqualTo(42001);

            // Spring ì´ ì œê³µí•˜ëŠ” ì˜ˆì™¸ ë³€í™˜ê¸°
            // Param ì— dataSource ë¥¼ ë„£ì–´ì¤€ë‹¤.
            SQLErrorCodeSQLExceptionTranslator exTranslator = new SQLErrorCodeSQLExceptionTranslator(dataSource);

            // exception ê²°ê³¼ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.
            // 1: error message
            // 2: ì‹¤í–‰ëœ SQL ë¬¸
            // 3: Exception
            DataAccessException resultEx = exTranslator.translate("select", sql, e);
            log.info("resultEx", resultEx);
            // ë¬¸ë²•ì´ ì˜ëª»ë«ê¸° ë•Œë¬¸ì— BadSqlGrammarException ìœ¼ë¡œ ë³€í™˜ë˜ì—ˆë‹¤.
            assertThat(resultEx.getClass()).isEqualTo(BadSqlGrammarException.class);
        }
    }
}
```

[ğŸ”—Â H2 DB ì˜ error code ë¦¬ìŠ¤íŠ¸](https://www.h2database.com/javadoc/org/h2/api/ErrorCode.html)