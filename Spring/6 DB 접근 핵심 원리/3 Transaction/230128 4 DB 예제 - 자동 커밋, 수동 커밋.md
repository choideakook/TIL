# DB ì˜ˆì œ - ìë™ ì»¤ë°‹, ìˆ˜ë™ ì»¤ë°‹

- ì˜ˆì œì— ì‚¬ìš©ë˜ëŠ” ìŠ¤í‚¤ë§ˆ

```sql
drop table member if exists;
  create table member (
      member_id varchar(10),
      money integer not null default 0,
      primary key (member_id)
);
```

## âœï¸Â Commit ì„¤ì •

ìë™ Commit ì„ ì„¤ì •í•˜ë©´ Query ì‹¤í–‰ ì§í›„ ìë™ìœ¼ë¡œ Commit ì„ í˜¸ì¶œí•œë‹¤.

ë”°ë¼ì„œ ì•ì„œ ì˜ˆì‹œì—ì„œ ì„¤ëª…í•œ Transaction ê¸°ëŠ¥ì„ ì œëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

### ğŸ“Â ìë™ Commit ì„¤ì •

```sql
set autocommit true; //ìë™ ì»¤ë°‹ ëª¨ë“œ ì„¤ì • (default)
```

```sql
insert into member(member_id, money) values ('data1',10000); //ìë™ ì»¤ë°‹
insert into member(member_id, money) values ('data2',10000); //ìë™ ì»¤ë°‹
```

data 1 ì´ commit ëœ í›„ dat2 ê°€ commit ë˜ëŠ” ìˆœì„œë¡œ ì‘ë™ëœë‹¤.

### ğŸ“Â ìˆ˜ë™ Commit ì„¤ì •

```sql
set autocommit false; //ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œ ì„¤ì •
insert into member(member_id, money) values ('data3',10000);
insert into member(member_id, money) values ('data4',10000);
```

```sql
commit; //ìˆ˜ë™ ì»¤ë°‹
rollback; // ë˜ëŒë¦¬ê¸°
```

ë³´í†µ ìë™ commit ëª¨ë“œë¡œ ì„¤ì •í•˜ê¸° ë•Œë¬¸ì—, ìë™ì—ì„œ ìˆ˜ë™ commit ëª¨ë“œë¡œ ì „í™˜í•˜ëŠ” ê²ƒì„ Transaction ì„ ì‹œì‘í•œë‹¤ê³  í‘œí˜„í•  ìˆ˜ ìˆë‹¤.

- Commit ì´ë‚˜ rollback ì„ í•˜ì§€ ì•Šë”ë¼ë„ í•´ë‹¹ ì„¸ì…˜ì—ì„œ ì„ì‹œë¡œ ì €ì¥ëœ data ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
- í•˜ì§€ë§Œ ë‹¤ë¥¸ ì„¸ì…˜ì—ì„œ ì„ì‹œ data ë¥¼ í™•ì¸í•  ìˆ˜ëŠ” ì—†ë‹¤.

âš ï¸Â ë³´í†µ commit, rollback ì•„ë¬´ê²ƒë„ í˜¸ì¶œí•˜ì§€ ì•Šì„ê²½ìš° ì¼ì • ì‹œê°„ì´ ì§€ë‚˜ë©´ ìë™ìœ¼ë¡œ rollback ì´ í˜¸ì¶œëœë‹¤.

<br>

## âœï¸Â Transaction ì—°ìŠµ ì„¸íŒ…

### ğŸ“Â ê¸°ë³¸ ì„¸íŒ…

- H2 ì˜ DB ì›¹ ì½˜ì†”ì°½ì„ 2ê°œ ì—´ì–´ë‘¬ì•¼ í•œë‹¤.
    - 2ê°œì˜ ì„¸ì…˜ì´ í•„ìš”í•˜ê¸° ë•Œë¬¸
- data ë¥¼ ì´ˆê¸°í™”í•˜ê³  ê¸°ë³¸ ì„¸íŒ…í•´ì£¼ê¸°

```sql
//ë°ì´í„° ì´ˆê¸°í™”
set autocommit true;
delete from member;
insert into member(member_id, money) values ('oldId',10000);
```

- 2 ê°œì˜ ì½˜ì†”ì— data ê°€ ì˜ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸í•˜ê³  ë‹¤ì‹œ false ë¡œ ë³€ê²½í•´ì¤€ë‹¤.

```sql
set autocommit false;
```

<br>

### â—ï¸ ì½˜ì†”ì°½ì˜ ì£¼ì†Œë¥¼ ë°”ë¡œ ë³µì‚¬í•˜ë©´ ì•ˆëœë‹¤.

- ì„¸ì…˜ id ê¹Œì§€ ë³µì‚¬ê°€ ë˜ì–´ë²„ë ¤ ë™ì¼í•œ ì„¸ì…˜ì˜ ì½˜ì†”ì°½ì´ 2ê°œê°€ ë‚˜íƒ€ë‚œë‹¤.
- localhost:8082 ì— ë“¤ì–´ê°€ë©´ ë‹¤ë¥¸ ì„¸ì…˜ id ë¡œ ëœ ì½˜ì†”ì„ ì¼¤ ìˆ˜ ìˆë‹¤.

<br>

ì´ ìƒíƒœì—ì„œ ì„¸ì…˜ 1, 2 ë¥¼ ì´ìš©í•´ ì•ì˜ ë‚´ìš©ì„ ì ìš©í•´ ë³¼ ìˆ˜ ìˆë‹¤.