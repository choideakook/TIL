# íšŒì› ë“±ë¡ API

## âœï¸Â API Member Controller

API controller ì—ì„œëŠ” @Controller ì™€ @ResponseBoy ì—ë…¸í…Œì´ì…˜ì´ í•©ì²˜ì§„

@RestController ì—ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•œë‹¤.

- ë°ì´í„° ìì²´ë¥¼ ë°”ë¡œ JSON ì´ë‚˜ XML ë¡œ ë³´ë‚¼ë•Œ ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì—ë…¸í…Œì´ì…˜ì´ë‹¤.

[ğŸ”—Â @ResponseBoy ì™€ @RequestBody](https://cheershennah.tistory.com/179)

<br>

- Api ìš© Class ë¥¼ ìƒì„±í•´ web ì´ ì—†ì´ë„ post man ì„ í†µí•´ ë¡œì§ì´ ì˜ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### ğŸ“Â Entity ë¥¼ Controller ì—ì„œ ì§ì ‘ êº¼ë‚´ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹

Entity ê°ì²´ì¸ Member ë¥¼ Controller ì—ì„œ ì§ì ‘ í˜¸ì¶œí•´ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ë‹¤.

- ì´ë ‡ê²Œ setting í•  ê²½ìš° Entity ê°ì²´ì™€ API ê°€ 1:1 ë¡œ mapping ëœë‹¤.
- ì´ ë°©ë²•ì€ Entity í•„ë“œëª…ì´ë‚˜ ì˜µì…˜ë“±ì´ ë³€ê²½ë  ê²½ìš° í™•ì¸í•˜ê¸° ì—ëŸ¬ë¡œì´ì–´ì§€ê²Œëœë‹¤.
- Entity ëŠ” ë§¤ìš° ë§ì€ Class ë“¤ê³¼ ì—°ê²°ë˜ì–´ìˆì–´ ë³€ê²½ì´ ì¦ì€ ê°ì²´ì´ë¯€ë¡œ í•´ë‹¹ ë°©ë²•ì€ ë¦¬ìŠ¤í¬ê°€ ë§¤ìš° í° ë°©ì‹ì´ë‹¤.

[ğŸ”—Â @Data ì–´ë…¸í…Œì´ì…˜](https://github.com/choideakook/TIL/blob/main/Spring/0%20Spring%20TIL/Lombok.md)

```java
package jpabook.jpashop.api;

import jpabook.jpashop.domain.Member;
import jpabook.jpashop.service.MemberService;
import lombok.Data;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

import javax.validation.Valid;

@RestController
@RequiredArgsConstructor
public class MeberApiController {

    private final MemberService memberService;

    // @RequestBody ë¥¼ í•˜ë©´ Member ê°ì²´ì— JSON ìœ¼ë¡œ ë°›ì€ body ë¥¼ ì…ë ¥ì‹œì¼œì¤€ë‹¤.
    // @Valid ë¥¼ ì´ìš©í•˜ë©´ server ê°€ ì•„ë‹Œ ê°ì²´ì—ì„œ ë“¤ì–´ì˜¤ëŠ” ê°’ì— ëŒ€í•´ ê²€ì¦ì„ í•  ìˆ˜ ìˆê²Œëœë‹¤.
    @PostMapping("/api/v1/members")
    public CreateMemberResponse saveMemberV1(@RequestBody @Valid Member member) {
        Long id = memberService.join(member);
        return new CreateMemberResponse(id);
    }

    @Data
    static class CreateMemberResponse {
        private Long id;

        public CreateMemberResponse(Long id) {
            this.id = id;
        }
    }

}
```

- post man ì—ì„œ Request ë¥¼ ìƒì„±í•œí›„ ì„¤ì •í•´ì¤€ë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-01-11 á„‹á…©á„’á…® 12.49.37.png](%E1%84%92%E1%85%AC%E1%84%8B%E1%85%AF%E1%86%AB%20%E1%84%83%E1%85%B3%E1%86%BC%E1%84%85%E1%85%A9%E1%86%A8%20API%20ace1603635ae415d9167c3a4a16f1ec1/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-01-11_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_12.49.37.png)

- url ì„ ë„£ê³  body raw json ìœ¼ë¡œ ë§ì¶°ì¤€ í›„ intput ì— ì›í•˜ëŠ” ì •ë³´ë¥¼ ì…ë ¥í›„ send í•˜ë©´ outpu ì— ê²°ê³¼ê°€ ë‚˜íƒ€ë‚œë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-01-11 á„‹á…©á„’á…® 12.51.29.png](%E1%84%92%E1%85%AC%E1%84%8B%E1%85%AF%E1%86%AB%20%E1%84%83%E1%85%B3%E1%86%BC%E1%84%85%E1%85%A9%E1%86%A8%20API%20ace1603635ae415d9167c3a4a16f1ec1/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-01-11_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_12.51.29.png)

- intellij ì—ì„œë„ test ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-01-11 á„‹á…©á„’á…® 12.57.54.png](%E1%84%92%E1%85%AC%E1%84%8B%E1%85%AF%E1%86%AB%20%E1%84%83%E1%85%B3%E1%86%BC%E1%84%85%E1%85%A9%E1%86%A8%20API%20ace1603635ae415d9167c3a4a16f1ec1/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-01-11_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_12.57.54.png)

<br>

## âœï¸Â PK ë§Œë“¤ê¸°

id í•„ë“œëŠ” @GeneratedValue ë¡œ ì¸í•´ DB ì—ì„œ ìë™ìœ¼ë¡œ ìƒì„±í•´ ì£¼ì§€ë§Œ

name í•„ë“œëŠ” PK ë¡œ ë“±ë¡ë˜ì—ˆì–´ë„ Entity ì— ì•„ë¬´ëŸ° ì œì•½ ì¡°ê±´ì„ ê±¸ì§€ ì•Šì•„ì„œ ì•„ë¬´ ê°’ë„ ë„£ì§€ ì•Šì•„ë„ ì •ìƒì²˜ë¦¬ ëœë‹¤.

### ğŸ“Â @NotEmpty

@NotEmpty ë¥¼ ì‚¬ìš©í•´ í•„ë“œì— ì œì•½ì„ ê±¸ì–´ì£¼ë©´ í•´ê²°ëœë‹¤.

- Controller ì˜ @Valid ê°€ ì²´í¬í•´ì„œ ì‘ë™ë˜ëŠ” ë°©ì‹

```java
package jpabook.jpashop.domain;

import lombok.Getter;
import lombok.Setter;

import javax.persistence.*;
import javax.validation.constraints.NotEmpty;
import java.util.ArrayList;
import java.util.List;

@Entity
@Getter @Setter
public class Member {

		// @GeneratedValue ì— ì˜í•´ ìë™ìœ¼ë¡œ ê°’ ìƒì„±
    @Id @GeneratedValue
    @Column (name = "member_id")
    private Long id;

		// ì‚¬ìš©ìê°€ ì§ì ‘ ê°’ì„ ê¼­ ì…ë ¥í•´ì•¼ í•˜ëŠ” PK ì— ì„¤ì •
    @NotEmpty
    private String name;

    @Embedded
    private Address address;

    @OneToMany (mappedBy = "member")
    private List<Order> orders = new ArrayList<>();
}
```

<br>

## âœï¸Â DTO ë¥¼ ìƒì„±í•´ Entity ë¥¼ ê°„ì ‘ì ìœ¼ë¡œ í˜¸ì¶œí•˜ê¸°

[ğŸ”—Â DTO ê°œë…](https://github.com/choideakook/TIL/blob/main/Spring/0%20Spring%20TIL/DTO%20%26%20VO.md)

- ì´ ë°©ì‹ì„ ì‚¬ìš©í• ê²½ìš° Entity ê°€ ë³€ê²½ë˜ë©´ ì»´íŒŒì¼ ì˜¤ë¥˜ë¡œ ë³€ê²½ì‚¬í•­ì„ ë¯¸ë¦¬ ì•Œë ¤ì¤€ë‹¤.

```java
package jpabook.jpashop.api;

import jpabook.jpashop.domain.Member;
import jpabook.jpashop.service.MemberService;
import lombok.Data;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

import javax.validation.Valid;

@RestController
@RequiredArgsConstructor
public class MeberApiController {

    private final MemberService memberService;

    // Entity ë¥¼ Parameter ê°’ìœ¼ë¡œ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ë°©ì‹
    @PostMapping("/api/v1/members")
    public CreateMemberResponse saveMemberV1(@RequestBody @Valid Member member) {
        Long id = memberService.join(member);
        return new CreateMemberResponse(id);
    }

    // DTO ë¥¼ ìƒì„±í•´ ê°’ë§Œ ë°›ì•„ì˜¤ëŠ” ë°©ì‹
    // ë³„ë„ì˜ ê°ì²´ CreateMemberRequest ë¥¼ ìƒì„±í•´ì„œ ê°’ë§Œ ê°€ì ¸ì˜´
    @PostMapping("/api/v2/members")
    private CreateMemberResponse saveMemberV2(@RequestBody @Valid CreateMemberRequest request) {
        Member member = new Member();
        member.setName(request.getName());
        Long id = memberService.join(member);
        return new CreateMemberResponse(id);
    }

		// Entity ë¥¼ ê°„ì ‘ì ìœ¼ë¡œ í˜¸ì¶œí•˜ê¸° ìœ„í•œ DTO ê°ì²´ë¥¼ ìƒì„±
		// í•„ë“œë¥¼ ì‚¬ìš©í•˜ê¸°ìœ„í•´ í•„ìš”í•œ ì œí•œ ì‚¬í•­ì€ DTO ì— ì…ë ¥í•´ì„œ
		// DTO ë§Œ ë³´ë”ë¼ë„ í•œëˆˆì— í™•ì¸í•  ìˆ˜ ìˆê²Œ ë§Œë“¤ì–´ì¤€ë‹¤.
    @Data
    static class CreateMemberRequest{
				@NotEmpty
        private String name;
    }

    @Data
    static class CreateMemberResponse {
        private Long id;

        public CreateMemberResponse(Long id) {
            this.id = id;
        }
    }

}
```

<br>

## âœï¸Â ì •ë¦¬

|  | v1 | v2 |
| --- | --- | --- |
| Entity ë³€ê²½ | API ìŠ¤íŒ© ìì²´ê°€ ë³€ê²½ë˜
í™•ì¸í•˜ê¸° ì–´ë ¤ìš´ ì—ëŸ¬ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆë‹¤. | API ìŠ¤íŒ©ì˜ ë³€ê²½ì´ ì—†ê³ 
ì»´íŒŒì¼ ì—ëŸ¬ë¡œ ë¯¸ë¦¬ ì•Œë ¤ì¤˜
ìˆ˜ì •ë§Œ í•´ì£¼ë©´ ì•„ë¬´ ë¬¸ì œ ì—†ë‹¤. |
| ì •ë³´ì˜ ì •í™•ì„± | Entity ë¥¼ ë°”ë¡œ ë„˜ê²¨ì¤„ ê²½ìš°
ì–´ëŠ í•„ë“œë¥¼ í•„ìš”ë¡œ í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ë§¤ìš° ë²ˆê±°ë¡­ë‹¤. | DTO ë¥¼ ê±°ì¹ ê²½ìš°
í•„ìš”í•œ í•„ë“œê°€ DTO ì— ë‹´ê²¨ìˆìœ¼ë¯€ë¡œ í•œëˆˆì— í™•ì¸í•  ìˆ˜ ìˆë‹¤. |
| Entity ì˜ ë²”ìš©ì„± | Api ë§ˆë‹¤ í•„ìš”ë¡œ í•˜ëŠ” ì •ë³´ê°€ ë‹¤ë¥¸ê²½ìš°ê°€ ë§ì€ë° ì œí•œì‚¬í•­ (@NotEmpy ë“±) ë“¤ì„ ê±¸ì–´ë†“ìœ¼ë©´ ë²”ìš©ì„±ì´ ë§¤ìš° ë–¨ì–´ì§€ê³ , ë‹¤ë¥¸ ì–´ë…¸í…Œì´ì…˜ê³¼ ì„ì—¬ ê°€ë…ì„±ì´ ë–¨ì–´ì§„ë‹¤. | íŠ¹ì • API ì—ì„œ í•„ìš”í•œ ì œí•œì‚¬í•­ì„ DTO ì— ì…ë ¥ì‹œì¼œ ë‹¤ë¥¸ API ì™€ ê´€ë ¨ì—†ì´ ë…ë¦½ì ìœ¼ë¡œ ì‚¬ìš©í•´ Entity ì˜ ë²”ìš©ì„±ì´ ë†’ì•„ì§„ë‹¤. |