# íšŒì› ì¡°íšŒ API

íšŒì› ì¡°íšŒë¥¼ í•˜ê¸°ìœ„í•´ ë¨¼ì € ì¡°íšŒí•´ë³¼ data ê°€ ë§ìœ¼ë©´ ì¢‹ìœ¼ë‹ˆ DB ê°€ ë¦¬ì…‹ë˜ì§€ ì•Šê²Œ ì„¤ì •í•´ì¤€ë‹¤.

- application.yml ì˜ jpa - hibernate - ddl - auto : none ìœ¼ë¡œ ìˆ˜ì •í•´ì¤Œ
    - ì»´íŒŒì¼ì„ ë‹¤ì‹œí•´ë„ DB ê°€ ë¦¬ì…‹ ë˜ì§€ ì•ŠëŠ”ë‹¤.

```java
spring:
  datasource:
    url: jdbc:h2:tcp://localhost/~/jpashop
    username: sa
    password:
    driver-class-name: org.h2.Driver

  jpa:
    hibernate:
      ddl-auto: none // create -> none
    properties:
      hibernate:
        format_sql: true

logging.level:
  org.hibernate.SQL: debug
  org.hibernate.type: trace
```

<br>

## âœï¸Â íšŒì› ì¡°íšŒ í•˜ê¸°

### ğŸ“Entity ë¥¼ ì§ì ‘ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹ - V1

```java
    // ëª¨ë“  íšŒì› ì¡°íšŒ
    @GetMapping ("/api/v1/members")
    public List<Member> membersV1 () {
        return memberService.findMembers();
    }
```

<br>

post man ìˆ˜ì •í›„ send í•˜ë©´ DB ì— ì €ì¥ëœ ê°’ë“¤ì´ ì¶œë ¥ëœë‹¤.

- â—ï¸ ë¬¸ì œì 
    - Member ì˜ íŠ¹ì • ì •ë³´ë§Œ ì›í•´ë„ ì´ ë°©ë²•ì€ entity ì˜ ëª¨ë“ ì •ë³´ê°€ ë…¸ì¶œë˜ì–´ë²„ë¦°ë‹¤.

<img width="543" alt="s41113" src="https://user-images.githubusercontent.com/115536240/211947319-e61b1239-9112-42b4-8e40-0b8b3720a39c.png">

<br>

- íŠ¹ì • í•„ë“œ ì œì™¸ì‹œí‚¤ê¸°
    - @JsonIgnore ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì£¼ë©´ í•´ë‹¹ í•„ë“œëŠ” ì¡°íšŒê°€ ë˜ì§€ ì•ŠëŠ”ë‹¤.

```java
@JsonIgnore
@OneToMany (mappedBy = "member")
private List<Order> orders = new ArrayList<>();
```

â—ï¸ ì´ ë°©ë²•ì„ ì‚¬ìš©í•  ê²½ìš° ë‹¤ë¥¸ ë§ì€ API ë“¤ì—ê²Œ ì‚¬ìš©ë˜ì•¼ í•˜ëŠ” Entity íŠ¹ì„±ìƒ ë²”ìš©ì„±ì´ ë§¤ìš° ë‚®ì•„ì§€ê³  ê°€ë…ì„±ë„ ë‹¤ë¥¸ ì—ë…¸í…Œì´ì…˜ê³¼ ì„ì—¬ ê°€ë…ì„±ë„ ì¢‹ì§€ì•ŠìŒ

<br>

### ğŸ“Â DTO ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ - V2

ì‘ë‹µê°’ì„ Result ì— ì¬ í¬ì¥í•´ì¤Œ

- ì¡°íšŒ Method ë¥¼ Collection ìœ¼ë¡œ ìƒì„±í•  ê²½ìš° json ë°°ì—´ íƒ€ì…ìœ¼ë¡œë§Œ output ëœë‹¤.
    - ì´ ê²½ìš° ë°°ì—´ ì •ë³´ë§Œ ì¶œë ¥ì´ ê°€ëŠ¥í•´ì§€ë©° ë‹¤ë¥¸ ìš”êµ¬ì‚¬í•­ë“¤ì„ ì¶”ê°€í•˜ëŠ” ë¡œì§ì„ ë§Œë“¤ ìˆ˜ ì—†ê²Œëœë‹¤.
        - ë‚ ì§œ, ë°ì´í„° ì´í•© ë“±ë“±..

[ğŸ”—Â stream ì‚¬ìš©ë²•](https://github.com/choideakook/TIL/blob/main/Class%20%26%20Method/221218_Stream.md)

```java
    // ëª¨ë“  íšŒì› ì¡°íšŒ - DTO ë¥¼ í†µí•˜ëŠ” ë°©ì‹
    @GetMapping ("/api/v2/members")
    public Result memberV2() {
        List<Member> findMember = memberService.findMembers();
        List<MemberDto> collect = findMember.stream()
                // map ì„ í†µí•´ ë°°ì—´ì„ ì›í•˜ëŠ” í˜•íƒœë¡œ ë³€ê²½í•¨
                // ì—¬ê¸°ì„  DTO ë¥¼ í†µí•´ name ê°’ë§Œ ê±¸ëŸ¬ëƒˆìŒ
                .map(m -> new MemberDto(m.getName()))
                .collect(Collectors.toList());
        return new Result(collect);
    }

    // Entity ë¥¼ ì§ì ‘ ë…¸ì¶œí•˜ì§€ ì•Šê¸°ìœ„í•œ ê»ë°ê¸° Class ìƒì„±
    // memberV2() ì˜ return ê°’ì´ ë˜ëŠ” Class ì´ë‹¤.
    // ì¶”ê°€ ìš”êµ¬ì‚¬í•­ë„ ì´ Class ì—ì„œ í•´ê²°í•  ìˆ˜ ìˆë‹¤.
    @Data @AllArgsConstructor
    static class Result<T> {
        private List<T> data;
    }

    // ì¡°íšŒ DTO - ì¡°íšŒ ì›í•˜ëŠ” í•„ë“œë¥¼ í¬í•¨ì‹œì¼œì¤Œ
    @Data @AllArgsConstructor
    static class MemberDto{
        private String name;
    }
```

<br>

ğŸ”Â ì¶œë ¥ ê°’

```java
{
    "data": [
        {
            "name": "hello1"
        },
        {
            "name": "hello world"
        },
        {
            "name": "ìµœëŒ€êµ­"
        }
    ]
}
```

### ğŸ“Â ì¶”ê°€ ìš”êµ¬ì‚¬í•­ ë°˜ì˜í•˜ê¸°

V2 ë°©ì‹ìœ¼ë¡œ ì½”ë”©í•  ê²½ìš° ì´í›„ì— ì¶”ê°€ ìš”êµ¬ì‚¬í•­ì´ ìƒê²¨ë„ ê°„ë‹¨í•˜ê²Œ ë°˜ì˜í•  ìˆ˜ ìˆë‹¤.

- ì¶”ê°€ ìš”êµ¬ì‚¬í•­ : ë°ì´í„°ì˜ ì´ ê°¯ìˆ˜ê°€ í•„ìš”í•˜ë‹¤.

```java
    @GetMapping ("/api/v2/members")
    public Result memberV2() {
        List<Member> findMember = memberService.findMembers();
        List<MemberDto> collect = findMember.stream()
                .map(m -> new MemberDto(m.getName()))
                .collect(Collectors.toList());
	// Parameter ê°’ ì¶”ê°€
        return new Result(collect.size(), collect);
    }

    @Data @AllArgsConstructor
    static class Result<T> {
	// í•„ë“œ ì¶”ê°€
        private int count;
        private List<T> data;
    }
```

<br>

ğŸ”Â ì¶œë ¥ë¬¼

```java
{
		"count": 3,
    "data": [
        {
            "name": "hello1"
        },
        {
            "name": "hello world"
        },
        {
            "name": "ìµœëŒ€êµ­"
        }
    ]
}
```
