# DB ì—°ê²° í…ŒìŠ¤íŠ¸

## âœï¸Â Member Class êµ¬í˜„

[ğŸ”—Â  Member ê´€ë ¨ ì• ë…¸í…Œì´ì…˜ ì„¤ëª…](https://github.com/choideakook/TIL/blob/main/Spring/1%20Spring%20ì…ë¬¸/4%20Spring%20DB%20ì ‘ê·¼%20ê¸°ìˆ /221215%20JPA%20ì—°ê²°%20ë°©ë²•.md)

```java
package jpabook.jpashop;

import lombok.Getter;
import lombok.Setter;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;

@Entity
@Getter @Setter
public class Member {

    @Id @GeneratedValue
    private Long ID;
    private String username;
    

}
```

<br>

## âœï¸Â Member Repository

ğŸ“œÂ Entity manager ì™€ êµ¬í˜„ì²´ ìƒì„±

- @PersistenceContext : EntityManager ë¥¼ DI í•´ì£¼ëŠ” ê¸°ëŠ¥

```java
package jpabook.jpashop;

import org.springframework.stereotype.Repository;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

@Repository
public class MemberRepository {

    @PersistenceContext  // EntityManager ë¥¼ ì£¼ì…í•˜ëŠ” ì• ë…¸í…Œì´ì…˜ (DI ë¥¼ í•´ì¤Œ)
    private EntityManager em;

		public Long save(Member member) {
        em.persist(member);
        return member.getID();
    }

    public Member find(Long id) {
        return em.find(Member.class, id);
    }
}
```

<br>

ğŸ“œÂ Test case

- RunWith (SpringRunner.class)
    - Spring ê³¼ í…ŒìŠ¤íŠ¸ í†µí•©í•˜ëŠ” ê¸°ëŠ¥
    - Junit 4 ê¹Œì§€ë§Œ ì§€ì› (Junit 5 ì—ì„œëŠ” ìƒëµ)
- SpringBootTest
    - Spring Container ë¥¼ ë„ìš°ê³  Spring ê³¼ ê´€ë ¨ëœ í†µí•©í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©
    - DB ì™€ ì—°ë™ë˜ì–´ ì²˜ë¦¬ í•  ê²½ìš° ì‚¬ìš©
    - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì˜ ê²½ìš°ì—ëŠ” í•„ìš” ì—†ìŒ
- ì°¸ê³  : ğŸ”—Â [@Transactional](https://github.com/choideakook/TIL/blob/main/Spring/1%20Spring%20ì…ë¬¸/4%20Spring%20DB%20ì ‘ê·¼%20ê¸°ìˆ /221214_ìŠ¤í”„ë§_í†µí•©_í…ŒìŠ¤íŠ¸.md) / Transactional ì´ ì—†ì„ ë•Œ ë°œìƒí•˜ëŠ” ì—ëŸ¬

```java
package jpabook.jpashop;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.annotation.Rollback;
import org.springframework.transaction.annotation.Transactional;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.*;

@SpringBootTest
@Transactional
//@Rollback (false) Transactionalì´ test ê°’ì„ db ì €ì¥í•˜ì§€ ëª»í•˜ê²Œí•˜ëŠ”ë° Rollback ì„ false ë¡œ ì„¤ì •í•˜ë©´ db ì— ì €ì¥ëœë‹¤.
class MemberRepositoryTest {

    @Autowired MemberRepository memberRepository;

    @Test
    void íšŒì›ì •ë³´ì €ì¥ (){
        Member member = new Member();
        member.setUsername("memberA");

        Long save = memberRepository.save(member);
        Member memberId = memberRepository.find(member.getId());

        assertThat(memberId.getId()).isEqualTo(member.getId());
        assertThat(memberId.getUsername()).isEqualTo(member.getUsername());
				assertThat(memberId).isEqualTo(member);
    }
}
```

<br>