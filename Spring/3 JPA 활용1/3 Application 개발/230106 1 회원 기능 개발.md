# íšŒì› ë„ë©”ì¸ ê°œë°œ

## âœï¸Â êµ¬í˜„ ê¸°ëŠ¥

- íšŒì› ë“±ë¡
- íšŒì› ëª©ë¡ ì¡°íšŒ

<br>

### ğŸ“Â ê°œë°œ ìˆœì„œ

- íšŒì› repository ê°œë°œ
- íšŒì› service ê°œë°œ
- íšŒì› ê¸°ëŠ¥ test

<br>

## âœï¸Â Repository ê°œë°œ

- íšŒì› ì €ì¥
- íŠ¹ì • íšŒì› ì¡°íšŒ
- ì „ì²´ íšŒì› ì¡°íšŒ
- íšŒì› ì´ë¦„ ê²€ìƒ‰

```java
package jpabook.jpashop.repository;

import jpabook.jpashop.domain.Member;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;

import javax.persistence.EntityManager;
import java.util.List;

@Repository
@RequiredArgsConstructor //lombok
public class MemberRepository {

		// lombok ì„ ì‚¬ìš©í•˜ë©´ @PersistenceContext ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë¨
    private final EntityManager em;  // lombok ìœ¼ë¡œ DI

    // persist -> ì˜ì†ì„± Context ì— member entity ê°ì²´ë¥¼ ë„£ìŒ
    // íŠ¸ë Œì ì…˜ì´ commit ë˜ëŠ” ìˆœê°„ DB ì— ë°˜ì˜ë¨
    public void save(Member member) {
        em.persist(member);
    }

    // ë‹¨ê±´ ì¡°íšŒ (ì²«ë²ˆì§¸ - íƒ€ì… , ë‘ë²ˆì§¸ - PK)
    public Member findOne(Long id) {
        return em.find(Member.class, id);
    }

    // JPQL (=ì¿¼ë¦¬ë¬¸ì‚¬ìš©) ì€ SQL ë¬¸ë²•ê³¼ ë¹„ìŠ·í•˜ì§€ë§Œ ëŒ€ìƒì´ Table ì´ ì•„ë‹Œ Entity ê°ì²´ ì´ë‹¤.
    public List<Member> findAll (){
        return em.createQuery("select m from Member m", Member.class)
                .getResultList();
    }

    // íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì„ ì‚¬ìš©í•´ íŠ¹ì • ì •ë³´ë¥¼ ì°¾ëŠ” ë°©ë²•
    public List<Member> findByName (String name){
        return em.createQuery(
                        "select m from Member m where m.name = :name", Member.class
                ).setParameter("name", name)
                .getResultList();
    }
}
```

## âœï¸Â íšŒì› Service ê°œë°œ

- íšŒì› ê°€ì…
- ì „ì²´ íšŒì› ì¡°íšŒ
- íŠ¹ì • íšŒì› ì¡°íšŒ

```java
package jpabook.jpashop.service;

import jpabook.jpashop.domain.Member;
import jpabook.jpashop.repository.MemberRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;

@Service
@RequiredArgsConstructor
@Transactional (readOnly = true) // readonly true ëŠ” DB ë³€ê²½ì´ì•„ë‹Œ ì½ê¸° ì „ìš©ì´ë¼ëŠ” ì˜ë¯¸
public class MemberService {

    private final MemberRepository memberRepository;

    @Transactional // join ì€ DB ë³€ê²½ì´ ê°€ëŠ¥í•˜ê¸°ë•Œë¬¸ì— True ë¥¼ í•´ì£¼ë©´ ì•ˆëœë‹¤ (default = false)
    public Long join(Member member) {

        validateDuplicateMember (member);
        memberRepository.save(member);
        return member.getId();
    }
    private void validateDuplicateMember(Member member) {

        List<Member> findMembers = memberRepository.findByName(member.getName());
        if (!findMembers.isEmpty()) {
            throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
        }
    }
    // ì¡°íšŒ ê¸°ëŠ¥ì´ê¸°ë•Œë¬¸ì— Transactional ì½ê¸° ì „ìš©ì— í•´ë‹¹í•œë‹¤.
    public List<Member> findMembers (){
        return memberRepository.findAll();
    }

    public Member findOne(Long memberId) {
        return memberRepository.findOne(memberId);
    }
}
```
