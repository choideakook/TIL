# ìƒí’ˆ ë„ë©”ì¸ ê°œë°œ

## âœï¸Â êµ¬í˜„ ê¸°ëŠ¥

- ìƒí’ˆ ë“±ë¡
- ìƒí’ˆ ëª©ë¡ ì¡°íšŒ
- ìƒí’ˆ ìˆ˜ì •

<br>

## âœï¸Â ê°œë°œ ìˆœì„œ

- ìƒí’ˆ Entity ê°œë°œ
    - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¶”ê°€
- ìƒí’ˆ Repository ê°œë°œ
- ìƒí’ˆ Service ê°œë°œ

<br>

## âœï¸Â ìƒí’ˆ Entity ê°œë°œ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¶”ê°€)

- ìƒí’ˆ êµ¬ì…ê³¼ ì·¨ì†Œì— ì˜í•œ ì¬ê³ ê°€ ë³€í™”ë˜ëŠ” ë¡œì§ ì¶”ê°€

```java
package jpabook.jpashop.domain.item;

import jpabook.jpashop.domain.Category;
import jpabook.jpashop.exception.NotEnoughStockException;
import lombok.Getter;
import lombok.Setter;

import javax.persistence.*;
import java.util.ArrayList;
import java.util.List;

@Entity
@Inheritance (strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn (name = "dtype")
@Getter @Setter
public abstract class Item {

    @Id @GeneratedValue
    @Column (name = "item_id")
    private Long id;
    private String name;
    private int price;
    private int stockQuantity;

    @ManyToMany (mappedBy = "items")
    private List<Category> categories = new ArrayList<>();

    //== ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ==//

    // ì¬ê³ ë¥¼ ì¶”ê°€í•˜ê³  ë‚®ì¶”ëŠ” ë¡œì§ì€ stockQuantity ë°ì´í„°ë§Œ ì‚¬ìš©í•˜ëŠ”ë°
    // ì´ëŸ°ê²½ìš°ëŠ” Service Class ë¥¼ ìƒì„±í•´ setter ë¡œ ì£¼ì…í•˜ëŠ” ê²ƒ ë³´ë‹¤,
    // Entity Class ì— ë¡œì§ì„ ë§Œë“¤ì–´ì„œ í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ëŠ” ê²ƒì´
    // ê°ì²´ì§€í–¥ì ìœ¼ë¡œ ë´¤ì„ ë•Œ ì‘ì§‘ë ¥ë„ ë†’ì•„ì§€ê³  ê´€ë¦¬ì°¨ì›ì—ì„œë„ ìˆ˜ì›”í•˜ë‹¤.
    
    // !!! ê°•ì˜ì—ì„œëŠ” í¸ì˜ìƒ setter ë¥¼ ìƒì„±í–ˆì§€ë§Œ setter ë¥¼ ë§Œë“¤ì§€ ì•ŠëŠ” ê²ƒì´ ì „ì²´ì ìœ¼ë¡œ ë” ì¢‹ë‹¤.

    /**
     * stock ì¦ê°€
     */
    public void addStock(int quantity) {
        this.stockQuantity += quantity;
    }
    /**
     * stock ê°ì†Œ
     * ì¬ê³ ê°€ ë§ˆì´ë„ˆìŠ¤ê°€ ë˜ë©´ ì•ˆë˜ê¸° ë•Œë¬¸ì— ì²´í¬í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ í•„ìš”í•˜ë‹¤.
     */
    public void removeStock(int quantity) {
        int restStock = this.stockQuantity - quantity;
        if (restStock < 0) {
						// ì¬ê³ ê°€ 0 ë³´ë‹¤ ì ì„ ë•Œ ë°œìƒë˜ëŠ” error ë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ëƒ„
            throw new NotEnoughStockException("need more stock");
        }
        this.stockQuantity = restStock;
    }
}
```

<br>

### ğŸ“Â ìƒˆë¡œìš´ Exception Class ë§Œë“¤ê¸°

- Runtime Exception ì„ extends í•´ì¤€ë‹¤.
- O + E ë¡œ Method ë“¤ì„ override í•´ì¤€ë‹¤.

```java
package jpabook.jpashop.exception;

public class NotEnoughStockException extends RuntimeException {

    public NotEnoughStockException() {
        super();
    }

    public NotEnoughStockException(String message) {
        super(message);
    }

    public NotEnoughStockException(String message, Throwable cause) {
        super(message, cause);
    }

    public NotEnoughStockException(Throwable cause) {
        super(cause);
    }
    
    // ë§ˆì§€ë§‰ method ëŠ” í•„ìš”ì—†ì–´ì„œ ì‚­ì œí–ˆìŒ
}
```

<br>

## âœï¸Â ìƒí’ˆ Repository ê°œë°œ

```java
package jpabook.jpashop.repository;

import jpabook.jpashop.domain.item.Item;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;

import javax.persistence.EntityManager;
import java.util.List;

@Repository
@RequiredArgsConstructor
public class ItemRepository {

    private final EntityManager em;

    // item ì€ JPA ì— ì €ì¥í•˜ê¸° ì „ê¹Œì§€ id ê°’ì´ ì—†ë‹¤.
        // (ì¦‰ ì™„ì „íˆ ìƒˆë¡œ ìƒì„±í•œ ê°ì²´ë¼ëŠ” ì˜ë¯¸)
    // ì¦‰ ì‹ ê·œ ë“±ë¡ì€ id ê°€ null ì´ê¸° ë•Œë¬¸ì— persist ë“±ë¡ í•´ì£¼ë©´ëœê³ ,
    // ì‹ ê·œê°€ ì•„ë‹Œ ì´ë¯¸ ë“±ë¡ë˜ì–´ìˆëŠ” item ì„ update í•˜ëŠ” ê²½ìš°ì—” id ê°’ì´ ì´ë¯¸ ìˆì„í…Œë‹ˆ
    // merge ë¡œ ë³‘í•©í•´ì„œ update í•´ì£¼ëŠ” ë¡œì§ì´ë‹¤.
    public void save(Item item) {
        if (item.getId() == null) {
            em.persist(item);
        } else {
            em.merge(item);
        }
    }

    public Item findOne(Long id) {
        return em.find(Item.class, id);
    }

    public List<Item> findAll() {
        return em.createQuery("select i from Item i", Item.class)
                .getResultList();
    }

}
```

<br>

## âœï¸Â ìƒí’ˆ Service ê°œë°œ

- ì´ì •ë„ ìˆ˜ì¤€ì˜ ë¡œì§ì˜ Service ëŠ” repository ì— ìœ„ì„ë§Œ í•˜ëŠ” ì •ë„ì˜ ìˆ˜ì¤€ì´ë‹¤.
    - ì‚¬ì‹¤ ì´ì •ë„ ìˆ˜ì¤€ì—ì„  Service ë¥¼ ìƒì„±í•˜ëŠ”ê²ƒë³´ë‹¤ Controller ì—ì„œ ë°”ë¡œ Repository mehtod ë¥¼ ì‚¬ìš©í•˜ëŠ”ê²ƒë„ ì¢‹ì€ë°©ë²•ì´ë‹¤.

```java
package jpabook.jpashop.service;

import jpabook.jpashop.domain.item.Item;
import jpabook.jpashop.repository.ItemRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;

@Service
@Transactional (readOnly = true)
@RequiredArgsConstructor
public class ItemService {

    private final ItemRepository itemRepository;

    @Transactional
    public void saveItem(Item item) {
        itemRepository.save(item);
    }

    public List<Item> findItems (){
        return itemRepository.findAll();
    }
    public Item findOne (Long itemId){
        return itemRepository.findOne(itemId);
    }

}
```