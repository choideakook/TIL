# V2 - View ë¶„ë¦¬

## âœï¸Â V1 ì˜ ë¬¸ì œì 

ëª¨ë“  Controller ì— JSP íŒŒì¼ì„ í˜¸ì¶œí•˜ëŠ” view ë¡œì§ì˜ ì¤‘ë³µì´ ë°œìƒí•˜ê³  ìˆë‹¤.

```java
String viewPath = "/WEB-INF/views/save-result.jsp";
RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
dispatcher.forward(request, response);
```

ë³„ë„ë¡œ View ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê°ì²´ë¥¼ ë§Œë“¤ì–´ ì´ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

<br>

## âœï¸Â V2 ì ìš©

### ğŸ“Â V2 ì˜ ëª©í‘œ

- View ë¥¼ ê´€ë¦¬í•˜ëŠ” ê°ì²´ë¥¼ ë”°ë¡œ ìƒì„±í•´ Controller ì˜ View ê´€ë ¨ ë¡œì§ì„ ë¦¬íŒ©í† ë§í•œë‹¤.

### ğŸ“Â V2 ì˜ êµ¬ì¡°

![s8531.png](V2%20-%20View%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%85%E1%85%B5%202f4f79c3ae4040d09d26bf443d5793eb/s8531.png)

<br>

### ğŸ“Â My View

- View path ë¥¼ ê´€ë¦¬í•˜ëŠ” ê°ì²´
- view path (JSP íŒŒì¼ì˜ ê²½ë¡œ) ì˜ ê°’ì€ ì™¸ë¶€ì—ì„œ ìƒì„±ì ì£¼ì… ë°©ì‹ìœ¼ë¡œ ì…ë ¥ëœë‹¤.
- ì…ë ¥ëœ view path ì˜ ê²½ë¡œë¥¼ ê¸°ë°˜ìœ¼ë¡œ jsp íŒŒì¼ì„ í˜¸ì¶œí•˜ê²Œ ëœë‹¤.

```java
package com.example.servlet.web.frontcontroller;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class MyView {

    private String viewPath;

    // view path í•„ë“œë¥¼ ì™¸ë¶€ì—ì„œ ìƒì„±ì ì£¼ì… ë°©ì‹ìœ¼ë¡œ ê°’ì„ ì£¼ì…í•œë‹¤.
    public MyView(String viewPath) {
        this.viewPath = viewPath;
    }
    
    // view path ë¥¼ í†µí•´ JSP íŒŒì¼ì„ í˜¸ì¶œí•˜ëŠ” ë¡œì§
    public void render(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }
}
```

<br>

### ğŸ“Â ControllerV2 - intrerface

- return ê°’ìœ¼ë¡œ my view ë¥¼ ë°˜í™˜í•œë‹¤.

```java
package com.example.servlet.web.frontcontroller.v2;

import com.example.servlet.web.frontcontroller.MyView;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public interface ControllerV2 {

    // V1 ê³¼ ê°™ì§€ë§Œ return ê°’ìœ¼ë¡œ My view ë¥¼ return í•  ìˆ˜ ìˆê²Œ ìˆ˜ì •í•´ì¤€ë‹¤.
    MyView process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException;
}
```

### ğŸ“Â íšŒì› ë“±ë¡ í¼

- return ê°’ìœ¼ë¡œ jsp ì˜ ê²½ë¡œë¥¼ ë°˜í™˜í•œë‹¤.
    - view ë¡œì§ì€ my view ê°ì²´ê°€ ëŒ€ì‹  ìˆ˜í–‰í•´ì¤€ë‹¤.

```java
package com.example.servlet.web.frontcontroller.v2.controller;

import com.example.servlet.web.frontcontroller.MyView;
import com.example.servlet.web.frontcontroller.v2.ControllerV2;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class MemberFormControllerV2 implements ControllerV2 {

    @Override
    public MyView process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        // return ê°’ìœ¼ë¡œ jsp ì˜ ê²½ë¡œë¥¼ ë°˜í™˜í•œë‹¤.
        return new MyView("/WEB-INF/views/new-form.jsp");
    }
}
```

### ğŸ“Â íšŒì› ë“±ë¡ ì™„ë£Œ í˜ì´ì§€

```java
package com.example.servlet.web.frontcontroller.v2.controller;

import com.example.servlet.domain.member.Member;
import com.example.servlet.domain.member.MemberRepository;
import com.example.servlet.web.frontcontroller.MyView;
import com.example.servlet.web.frontcontroller.v2.ControllerV2;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class MemberSaveControllerV2 implements ControllerV2 {

    private MemberRepository repository = MemberRepository.getInstance();

    @Override
    public MyView process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    
        // map ì—ì„œ param ê°’ì„ ë³€ìˆ˜ì— ë‹´ëŠ”ë‹¤.
        String username = request.getParameter("username");
        int age = Integer.parseInt(request.getParameter("age"));

        //-- business logic --//
        Member member = new Member(username, age);
        repository.save(member);

        //-- business logic ì˜ ê²°ê³¼ë¥¼ model ì— ì €ì¥ --//
        request.setAttribute("member", member);

        // view path return
        return new MyView("/WEB-INF/views/save-result.jsp");
    }
}
```

### ğŸ“Â ëª¨ë“  íšŒì› ì¡°íšŒ

```java
package com.example.servlet.web.frontcontroller.v2.controller;

import com.example.servlet.domain.member.Member;
import com.example.servlet.domain.member.MemberRepository;
import com.example.servlet.web.frontcontroller.MyView;
import com.example.servlet.web.frontcontroller.v2.ControllerV2;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.List;

public class MemberListControllerV2 implements ControllerV2 {

    private MemberRepository repository = MemberRepository.getInstance();

    @Override
    public MyView process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        List<Member> members = repository.findAll();

        request.setAttribute("members", members);

        return new MyView("/WEB-INF/views/members.jsp");
    }
}
```

<br>

### ğŸ“Â Front Controller V2

- HTTP ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ url ì„ key ê°’ìœ¼ë¡œ map ì„ í†µí•´ value ê°’ì¸ Controller ë¥¼ ì°¾ì•„ êµ¬í˜„ì²´ë¡œ ì„ íƒí•´ ì‹¤í–‰ì‹œí‚¨ë‹¤.
- Controller ì˜ business ë¡œì§ì´ ëë‚˜ê³  ë°˜í™˜ëœ return ê°’ì„ í†µí•´
MyView ëŠ” JSP íŒŒì¼ì„ í˜¸ì¶œì‹œí‚¨ë‹¤.

```java
package com.example.servlet.web.frontcontroller.v2;

import com.example.servlet.web.frontcontroller.MyView;
import com.example.servlet.web.frontcontroller.v1.ControllerV1;
import com.example.servlet.web.frontcontroller.v2.controller.MemberFormControllerV2;
import com.example.servlet.web.frontcontroller.v2.controller.MemberListControllerV2;
import com.example.servlet.web.frontcontroller.v2.controller.MemberSaveControllerV2;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

@WebServlet(name = "frontControllerServletV2", urlPatterns = "/front-controller/v2/*")
public class FrontControllerServletV2 extends HttpServlet {

    private Map<String, ControllerV2> controllerMap = new HashMap<>();

    // ê¸°ë³¸ìƒì„±ìì—ì„œ map ì˜ ì¸ë±ìŠ¤ë¥¼ ë¯¸ë¦¬ ì¤€ë¹„í•´ ë‘”ë‹¤.
    public FrontControllerServletV2() {
        controllerMap.put("/front-controller/v2/members/new-form", new MemberFormControllerV2());
        controllerMap.put("/front-controller/v2/members/save", new MemberSaveControllerV2());
        controllerMap.put("/front-controller/v2/members", new MemberListControllerV2());
    }

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
  
        // HTTP ìš”ì²­ url ì„ ê°ì²´í™” í•˜ê³  map ì—ì„œ ì•Œë§ì€ Controller ë¥¼ ì°¾ëŠ”ë‹¤.
        // Controller ë¥¼ ì°¾ì§€ ëª»í• ê²½ìš° 404 not found
        String requestURI = request.getRequestURI();
        ControllerV2 controller = controllerMap.get(requestURI);
        if (controller == null) {
            response.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        // Controller ë¥¼ ì‹¤í–‰ì‹œí‚¤ê³  
        // controller ì˜ return ê°’ì„ í†µí•´ My View ë¥¼ ì‹¤í–‰í•´ jsp íŒŒì¼ì„ í˜¸ì¶œí•œë‹¤. 
        MyView view = controller.process(request, response);
        view.render(request, response);
    }
}
```

<br>

## âœï¸Â ì •ë¦¬

- Controller ì—ì„œ ì¤‘ë³µìœ¼ë¡œ ì‚¬ìš©ë˜ì—ˆë˜ View ì˜ í˜¸ì¶œ ë¡œì§ì„ ë¦¬íŒ©í† ë§ í–ˆë‹¤.
    - return ê°’ì„ ì´ìš©í•´ JSP íŒŒì¼ì˜ ê²½ë¡œë¥¼ View ë¡œì§ì„ ë‹´ë‹¹í•˜ëŠ” ê°ì²´ì— ì „ë‹¬.
    - View ë¡œì§ì€ return ê°’ì„ ì´ìš©í•´ jsp íŒŒì¼ì„ í˜¸ì¶œí•˜ê¸°ë§Œ í•˜ë©´ ëœë‹¤.
- V2 ì˜ í•œê³„
    - ëª¨ë“  Conrtroller ì—ì„œ request ì™€ response ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŒì—ë„ ë¶ˆêµ¬í•˜ê³ 
     model ì— ê°’ì„ ë„˜ê²¨ì£¼ì–´ì•¼ í•œë‹¤ëŠ” ì´ìœ ë§Œìœ¼ë¡œ ì˜ë¬´ì ìœ¼ë¡œ ê°ì²´ë¥¼ ìƒì„±í•˜ê³ ìˆë‹¤.
    - Controller return ê°’ì— JSP íŒŒì¼ì˜ ê²½ë¡œê°€ ì¤‘ë³µë˜ê³ ìˆë‹¤.
    (ë§Œì•½ ê²½ë¡œê°€ ë³€ê²½ë ê²½ìš° ëª¨ë“  Controller ì˜ ê²½ë¡œë¥¼ í•˜ë‚˜í•˜ë‚˜ ë³€ê²½í•´ì•¼í•œë‹¤.)