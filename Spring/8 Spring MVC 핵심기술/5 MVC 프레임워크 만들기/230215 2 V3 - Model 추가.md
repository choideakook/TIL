# V3 - Model ì¶”ê°€

## âœï¸Â V3 ëª©í‘œ

### ğŸ“Â ì„œë¸”ë¦¿ ì¢…ì†ì„± ì œê±°

`Controller` ì…ì¥ì—ì„œ `request` ì™€ `response` ëŠ” í•„ìˆ˜ë¡œ í•„ìš”í•œ ê°ì²´ê°€ ì•„ë‹ˆë‹¤.

ìš”ì²­ íŒŒë¼ë¯¸í„° data ëŠ” `Map` ìœ¼ë¡œ ëŒ€ì‹  ë„˜ê²¨ `request` ì—†ì´ë„ ë™ì‘ ê°€ëŠ¥í•˜ê³ ,

ìš”ì²­ ê°ì²´ë¥¼ Model ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë³„ë„ì˜ Model ê°ì²´ë¥¼ ë§Œë“¤ì–´ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

- V3 ì—ì„œëŠ” Controller ê°€ Servlet ì˜ ê¸°ìˆ ì— ì˜ì¡´í•˜ì§€ ì•Šê²Œ ë³€ê²½í•˜ëŠ” ê²ƒ ì´ë‹¤.

<br>

### ğŸ“Â View ì´ë¦„ì˜ ì¤‘ë³µ ì œê±°

`Controller` ì˜ `return` ê°’ì—ì„œ `jsp` ê°€ ìœ„ì¹˜í•œ ê²½ë¡œê°€ ì¤‘ë³µë˜ê³ ìˆë‹¤.

`Controller` ì—ì„œëŠ” ë‹¨ìˆœ íŒŒì¼ëª… (ë…¼ë¦¬ ì´ë¦„) ì„ `return` í•˜ê³  `Front Controller` ì—ì„œ ê²½ë¡œë¥¼ ì…ë ¥í•´ì£¼ëŠ” ë°©ë²•ìœ¼ë¡œ ì´ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

- ì´ ë°©ë²•ìœ¼ë¡œ ë¦¬íŒ©í† ë§í•˜ë©´ ì¶”í›„ì— jsp íŒŒì¼ì˜ ê²½ë¡œê°€ ë³€ê²½ë˜ì–´ë„ `front controller` ì˜ ê²½ë¡œ í•œë²ˆë§Œ ë°”ê¿”ì£¼ë©´ ëª¨ë“  `Controller` ì˜ ê²½ë¡œê°€ ë³€ê²½ëœë‹¤.

<br>

### ğŸ“Â ModelView ê°ì²´ì˜ ìƒì„±

Controller ëŠ” Servlet ì— ì¢…ì†ì ì¸ `request` ë¥¼ ì‚¬ìš©í•´ `setAtrribute()` ë¥¼ í†µí•´ data ë¥¼ ì €ì¥í•˜ê³ , View ì— ì „ë‹¬í•˜ëŠ” ë°©ì‹ì´ ì•„ë‹Œ,

Model ê°ì²´ë¥¼ ì§ì ‘ ë§Œë“¤ê³  ì´ ê°ì²´ì—ì„œ View ì´ë¦„ê¹Œì§€ ê°™ì´ ì „ë‹¬í•´ Servlet ì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ” Controller ë¥¼ ë§Œë“¤ ìˆ˜ ìˆê²Œëœë‹¤.

### ğŸ“Â V3 ì˜ êµ¬ì¡°

![s8541.png](V3%20-%20Model%20%E1%84%8E%E1%85%AE%E1%84%80%E1%85%A1%20157bfacf84b942acac28b86896ca0136/s8541.png)

<br>

## âœï¸Â V3 ì ìš©

### ğŸ“Â ModelView

- Controller ì˜ return ê°’ì„ ë°›ì„ ê°ì²´
    - View Path ì˜ ë…¼ë¦¬ ì´ë¦„ì„ ë‹´ëŠ” í•„ë“œ
    - Controller ì—ì„œ Model ì— ì €ì¥í•´ì•¼ í•  business ë¡œì§ì˜ ê²°ê³¼ë¥¼ ë³´ê´€í•  Map
- ModelView ì˜ í•„ë“œê°’ë“¤ì€ Front Controller ì—ì„œ MyView ë¥¼ í†µí•´ Model ì— data ë¥¼ ì €ì¥í•˜ê³ , JSP íŒŒì¼ì„ ì°¾ì•„ HTML ì„ ëœë”ë§ í•˜ê²Œ ëœë‹¤.

```java
package com.example.servlet.web.frontcontroller;

import lombok.Getter;
import lombok.Setter;

import java.util.HashMap;
import java.util.Map;

@Getter @Setter
public class ModelView {

    // View Path ì˜ ë…¼ë¦¬ ì´ë¦„ì„ ë‹´ëŠ” í•„ë“œ
    private String viewName;
    // business ë¡œì§ì˜ ê²°ê³¼ data ë¥¼ ì €ì¥í•˜ëŠ” map ê°ì²´
    private Map<String, Object> model = new HashMap<>();

    // ìƒì„±ìëŠ” view name ë§Œ ë°›ëŠ”ë‹¤.
    public ModelView(String viewName) {
        this.viewName = viewName;
    }
}
```

<br>

### ğŸ“Â ControllerV3 - interface

- Servlet ê¸°ìˆ ì— ì¢…ì†ì ì´ì§€ ì•Šì€ interface ê°€ ìƒì„±ë˜ì—ˆë‹¤.

```java
package com.example.servlet.web.frontcontroller.v3;

import com.example.servlet.web.frontcontroller.ModelView;

import java.util.Map;

public interface ControllerV3 {

    // servlet ê¸°ìˆ ì— ì¢…ì†ì ì´ì§€ ì•Šì€ method ë¥¼ ìƒì„±
    ModelView process(Map<String, String> paramMap);
}
```

<br>

### ğŸ“Â íšŒì› ë“±ë¡ í¼

- Servlet ì— ì¢…ì†ì ì´ì§€ ì•Šìœ¼ë¯€ë¡œ Class ê°€ ê°„ê²°í•´ ì¡Œë‹¤.
    - Test ìˆ˜í–‰ë„ ê°„í¸í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤.
- return ê°’ìœ¼ë¡œ jsp íŒŒì¼ê²½ë¡œì˜ ë…¼ë¦¬ ì´ë¦„ì„ ë„˜ê²¨ì¤€ë‹¤.

```java
package com.example.servlet.web.frontcontroller.v3.controller;

import com.example.servlet.web.frontcontroller.ModelView;
import com.example.servlet.web.frontcontroller.v3.ControllerV3;

import java.util.Map;

public class MemberFormControllerV3 implements ControllerV3 {

    @Override
    public ModelView process(Map<String, String> paramMap) {

        // return ê°’ìœ¼ë¡œ jsp íŒŒì¼ê²½ë¡œì˜ ë…¼ë¦¬ ì´ë¦„ì„ ë„˜ê²¨ì¤€ë‹¤.
        return new ModelView("new-form");
    }
}
```

<br>

### ğŸ“Â íšŒì› ë“±ë¡ ì™„ë£Œ í˜ì´ì§€

- business logic ì˜ ê²°ê³¼ data ë¥¼ `setAttribute` ê°€ ì•„ë‹Œ `map` ì— ì €ì¥í•œë‹¤.

```java
package com.example.servlet.web.frontcontroller.v3.controller;

import com.example.servlet.domain.member.Member;
import com.example.servlet.domain.member.MemberRepository;
import com.example.servlet.web.frontcontroller.ModelView;
import com.example.servlet.web.frontcontroller.v3.ControllerV3;

import java.util.Map;

public class MemberSaveControllerV3 implements ControllerV3 {

    private MemberRepository repository = MemberRepository.getInstance();

    @Override
    public ModelView process(Map<String, String> paramMap) {

        // map ì—ì„œ í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­í•œ parameter ê°’ì„ ë³€ìˆ˜ì— ì €ì¥
        String username = paramMap.get("username");
        int age = Integer.parseInt(paramMap.get("age"));

        // í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì •ë³´ë¡œ db ì— ì €ì¥
        Member member = new Member(username, age);
        repository.save(member);

        // model view ê°ì²´ë¥¼ ìƒì„±í•´ ë…¼ë¦¬ ì´ë¦„ì„ ë„£ì–´ì¤€ë‹¤.
        ModelView mv = new ModelView("save-result");
        // model (map) ì— view ë¡œ ë„˜ê²¨ì¤„ data ë¥¼ ì…ë ¥í•œë‹¤.
        mv.getModel().put("member", member);

        // ì™„ì„±ëœ model view ë¥¼ ë°˜í™˜í•œë‹¤.
        return mv;
    }

}
```

<br>

### ğŸ“Â ëª¨ë“  íšŒì› ì¡°íšŒ

```java
package com.example.servlet.web.frontcontroller.v3.controller;

import com.example.servlet.domain.member.Member;
import com.example.servlet.domain.member.MemberRepository;
import com.example.servlet.web.frontcontroller.ModelView;
import com.example.servlet.web.frontcontroller.v3.ControllerV3;

import java.util.List;
import java.util.Map;

public class MemberListControllerV3 implements ControllerV3 {

    private MemberRepository repository = MemberRepository.getInstance();

    @Override
    public ModelView process(Map<String, String> paramMap) {

        List<Member> members = repository.findAll();

        // model view ê°ì²´ë¥¼ ìƒì„±í•´ ë…¼ë¦¬ ì´ë¦„ì„ ë„£ì–´ì¤€ë‹¤.
        ModelView mv = new ModelView("members");
        // model (map) ì— view ë¡œ ë„˜ê²¨ì¤„ data ë¥¼ ì…ë ¥í•œë‹¤.
        mv.getModel().put("members", members);

        // ì™„ì„±ëœ model view ë¥¼ ë°˜í™˜í•œë‹¤.
        return mv;
    }
}
```

<br>

### ğŸ“Â Front Controller V3

- Controller ì˜ Sevlet ìœ¼ë¡œë¶€í„° ë…ë¦½ì„ ìœ„í•´ `ìš”ì²­ parameter ê°’` ì„ `map` ìœ¼ë¡œ ë³€í™˜í•œë‹¤.
    - Controller ëŠ” `map` ì— ë‹´ê¸´ `param ê°’` ì„ ì´ìš©í•´ business ë¡œì§ì„ ìˆ˜í–‰í•œë‹¤.
- Cotroller ì˜ return ê°’ì¸ `Model View` ë¥¼ í†µí•´ Model ì— data ë¥¼ ì €ì¥í•˜ê³ ,
JSP íŒŒì¼ì„ í˜¸ì¶œí•œë‹¤.
    - `model view` ì˜ ë…¼ë¦¬ì´ë¦„ì„ ì¶”ì¶œí•´ `My View ê°ì²´` ë¥¼ ìƒì„±í•´ ì™„ì „í•œ ê²½ë¡œë¡œ ë³€í™˜í•´ì¤€ë‹¤.
    - `My View` ì˜ `forward` ë¥¼ í†µí•´ ì™„ì„±ëœ ê²½ë¡œì˜ JSP íŒŒì¼ì„ í˜¸ì¶œí•œë‹¤.

```java
package com.example.servlet.web.frontcontroller.v3.controller;

import com.example.servlet.web.frontcontroller.ModelView;
import com.example.servlet.web.frontcontroller.MyView;
import com.example.servlet.web.frontcontroller.v3.ControllerV3;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

@WebServlet(name = "frontControllerServletV3", urlPatterns = "/front-controller/v3/*")
public class FrontControllerServletV3 extends HttpServlet {

    private Map<String, ControllerV3> controllerMap = new HashMap<>();

    public FrontControllerServletV3() {
        controllerMap.put("/front-controller/v3/members/new-form", new MemberFormControllerV3());
        controllerMap.put("/front-controller/v3/members/save", new MemberSaveControllerV3());
        controllerMap.put("/front-controller/v3/members", new MemberListControllerV3());
    }

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        String requestURI = request.getRequestURI();
        ControllerV3 controller = controllerMap.get(requestURI);
        if (controller == null) {
            response.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        // HTTP ìš”ì²­ param ê°’ì„ map ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ë¡œì§
        Map<String, String> paramMap = createParamMap(request);

        // ë³€í™˜ëœ param ê°’ì„ ë‹´ì€ map ì„ í†µí•´ process ë¥¼ ì‹¤í–‰í•œë‹¤.
        // ì‹¤í–‰ ê²°ê³¼ì˜ ë°˜í™˜ê°’ìœ¼ë¡œ model view ê°€ return ë¨
        ModelView mv = controller.process(paramMap);
        
        // ë…¼ë¦¬ì´ë¦„ì„ ì™„ì „í•œ ê²½ë¡œë¡œ ë§Œë“¤ì–´ì£¼ê¸° ìœ„í•´ view name ë§Œ ì¶”ì¶œí•œë‹¤.
        String viewName = mv.getViewName();
        // My view ë¥¼ ìƒì„±í•´ ë…¼ë¦¬ì´ë¦„ì„ ì™„ì „í•œ ê²½ë¡œë¡œ ë§Œë“¤ì–´ì¤€ë‹¤. 
        MyView view = viewResolver(viewName);
        
        // ì™„ì„±ëœ ê²½ë¡œë¥¼ í†µí•´ JSP íŒŒì¼ì„ ì‹¤í–‰ì‹œí‚¨ë‹¤.
        // V2 ì™€ ë‹¤ë¥´ê²Œ Controller ê°€ ì €ì¥í•œ model ê°’ë„ ê°™ì´ ë„˜ê²¨ì¤˜ì•¼í•œë‹¤.
        view.render(mv.getModel(), request, response);
    }

    // HTTP ìš”ì²­ param ê°’ì„ map ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” method
    private static Map<String, String> createParamMap(HttpServletRequest request) {
        Map<String, String> paramMap = new HashMap<>();
        request.getParameterNames().asIterator()
                        .forEachRemaining(paramName ->
                                paramMap.put(paramName, request.getParameter(paramName)));
        return paramMap;
    }
    
    // View path ê²½ë¡œ ì™„ì„± method
    private static MyView viewResolver(String viewName) {
        return new MyView("/WEB-INF/views/" + viewName + ".jsp");
    }
}
```

<br>

### ğŸ“Â MyView

Front Controller ì—ì„œ ë„˜ê²¨ë°›ì€ param ìœ¼ë¡œ ë§ˆë¬´ë¦¬ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.

1. Business ë¡œì§ì˜ ê²°ê³¼ë¬¼ì„ Model ì— ì €ì¥
    - Business ë¡œì§ ê²°ê³¼ë¬¼ì„ ë‹´ì€ map ì˜ ê°’ì„ `setAttribute` ë¥¼ í†µí•´ Model ì— ì €ì¥
    - View ì—ì„œ model ì„ ì°¸ê³ í•´ ë™ì  HTML ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.
2. View Path ì˜ ê²½ë¡œì—ìˆëŠ” JSP í˜¸ì¶œ
    - *`viewResolver`* ê°€ ì™„ì„±í•œ View Path ë¡œ `forward` ë¥¼ ì‚¬ìš©í•´ JSP ë¥¼ í˜¸ì¶œí•œë‹¤.

```java
package com.example.servlet.web.frontcontroller;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.Map;

public class MyView {

    private String viewPath;

    //-- ìƒì„±ì --//
    public MyView(String viewPath) {
        this.viewPath = viewPath;
    }
    //-- V2 ---//
    public void render(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }

    //-- V3 --//
    // map ì— ë‹´ê¸´ request ê°’ì„ model ì— ì „ë‹¬í•˜ëŠ” ê¸°ëŠ¥ì„ í¬í•¨í•œ ë¡œì§
    public void render(Map<String, Object> model, HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        // business ë¡œì§ì„ ì™„ë£Œí•œí›„ Controller ê°€ map ì— ë‹´ì€ data (model) ë¥¼
        // setAttribute ë©”ì„œë“œë¡œ Model ê°ì²´ì— ë‹´ì•„ì¤€ë‹¤.
        modelToRequestAttribute(model, request);

        //view path ë¥¼ í†µí•´ JSP íŒŒì¼ì„ í˜¸ì¶œí•œë‹¤.
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }

    //-- controller ì˜ data ë¥¼ model ì— ì €ì¥í•˜ëŠ” method --//
    private static void modelToRequestAttribute(Map<String, Object> model, HttpServletRequest request) {
        model.forEach((key, value) -> request.setAttribute(key, value));
    }
}
```