# ìƒí’ˆ ë„ë©”ì¸ ê°œë°œ

### âœï¸Â Entity

```java
package hello.itemservice.domain.item;

import lombok.Data;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;

import static lombok.AccessLevel.PROTECTED;

@Getter @Setter
@NoArgsConstructor(access = PROTECTED)
public class Item {

    private Long id;
    private String itemName;

    // Integer ë¥¼ ì‚¬ìš©í•˜ë©´ ê°’ì´ null ì´ ë˜ë„ ì˜ˆì™¸ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.
    private Integer price;
    private Integer quantity;

    //-- ìƒì„± method --//

    public Item(String itemName, Integer price, Integer quantity) {
        this.itemName = itemName;
        this.price = price;
        this.quantity = quantity;
    }
}
```

<br>

## âœï¸Â Repository

```java
package hello.itemservice.domain.item;

import org.springframework.stereotype.Repository;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@Repository
public class ItemRepository {

    // ì‹±ê¸€í†¤ìœ¼ë¡œ ìš´ì˜í•˜ê¸° ìœ„í•´ static ì„ ë¶™ì—¬ì¤€ë‹¤.
    // Spring ì„ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— ì‚¬ì‹¤ static ì„ ë¶™ì—¬ì£¼ì§€ ì•Šì•„ë„ ìë™ ì‹±ê¸€í†¤ì´ ì ìš©ëœë‹¤.
    private static final Map<Long, Item> store = new HashMap<>(); // ë©€í‹° Thread í™˜ê²½ì—ì„œëŠ” ConcurrentMap ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
    private static long sequence = 0L;

    //-- sava --//
    public Item sava(Item item) {
        item.setId(++sequence);
        store.put(item.getId(), item);
        return item;
    }

    //-- ë‹¨ê±´ ì¡°íšŒ --//
    public Item findOne(Long id) {
        return store.get(id);
    }

    //-- ì „ì²´ ì¡°íšŒ --//
    public List<Item> findAll() {
        // ì¡°íšŒëœ data ë¥¼ ìˆ˜ì •í•´ë„ store ì— ë°˜ì˜ë˜ì§€ ì•Šê²Œ í•˜ê¸° ìœ„í•´ì„œ
        // ìƒˆë¡œìš´ List ë¥¼ ìƒì„±í•´ì„œ return í•´ì¤€ë‹¤.
        return new ArrayList<>(store.values());
    }

    //-- update --//
    public void update(Long id, Item updateParam) {
        // í”„ë¡œì íŠ¸ê°€ ì‘ê¸° ë•Œë¬¸ì— setter ë¥¼ í†µí•´ì„œ ì§ì ‘ì ìœ¼ë¡œ ìˆ˜ì •ì‹œì¼œì¤€ë‹¤.
        // ì •ì„ì€ ë³„ë„ì˜ DTO ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ë§ë‹¤.
        Item findItem = findOne(id);
        findItem.setItemName(updateParam.getItemName());
        findItem.setPrice(updateParam.getPrice());
        findItem.setQuantity(updateParam.getQuantity());
    }

    //-- test ìš© ë¡œì§ --//
    public void clearStore() {
        store.clear();
    }
}
```

### ğŸ“Â Repository Test

```java
package hello.itemservice.domain.item;

import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.Test;

import java.util.List;

import static org.assertj.core.api.Assertions.assertThat;

class ItemRepositoryTest {

    ItemRepository itemRepository = new ItemRepository();

    @AfterEach
    void afterEach() {
        itemRepository.clearStore();
    }

    @Test
    void sava() {
        Item item = new Item("itemA", 10000, 10);

        Item savaItem = itemRepository.sava(item);
        Item findItem = itemRepository.findOne(item.getId());

        assertThat(findItem).isEqualTo(savaItem);
    }

    @Test
    void findAll() {
        Item item1 = new Item("itemA", 10000, 10);
        Item item2 = new Item("itemA", 20000, 20);

        Item savaItem1 = itemRepository.sava(item1);
        Item savaItem2 = itemRepository.sava(item2);

        List<Item> findAll = itemRepository.findAll();

        assertThat(findAll.size()).isEqualTo(2);
        assertThat(findAll).contains(savaItem1, savaItem2);
    }

    @Test
    void update() {
        Item item = new Item("itemA", 10000, 10);

        Item savedItem = itemRepository.sava(item);
        Long itemId = savedItem.getId();

        Item updateParam = new Item("item2", 20000, 20);
        itemRepository.update(itemId, updateParam);

        Item findItem = itemRepository.findOne(itemId);

        assertThat(findItem.getItemName()).isEqualTo(updateParam.getItemName());
        assertThat(findItem.getPrice()).isEqualTo(updateParam.getPrice());
        assertThat(findItem.getQuantity()).isEqualTo(updateParam.getQuantity());
    }
}
```