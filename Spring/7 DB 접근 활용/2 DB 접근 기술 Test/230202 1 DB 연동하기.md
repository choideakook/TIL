# DB ì—°ë™í•˜ê¸°

## âœï¸Â @SpringBootTest

Test Class ì— SpringBootTest ì–´ë…¸í…Œì´ì…˜ì´ ìˆìœ¼ë©´
application Class ì˜ @SpringBootApplication ì„ ì°¾ì€ í›„
í•´ë‹¹ class ì˜ ì„¸íŒ…ì„ ê·¸ëŒ€ë¡œ Test class ì— ì˜®ê²¨ì¤€ë‹¤.

```java
package hello.itemservice;

import hello.itemservice.config.*;
import hello.itemservice.repository.ItemRepository;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Import;
import org.springframework.context.annotation.Profile;

@Import(JdbcTemplateV3Config.class)
@SpringBootApplication(scanBasePackages = "hello.itemservice.web")
public class ItemServiceApplication {

	public static void main(String[] args) {
		SpringApplication.run(ItemServiceApplication.class, args);
	}

	@Bean
	@Profile("local")
	public TestDataInit testDataInit(ItemRepository itemRepository) {
		return new TestDataInit(itemRepository);
	}

}
```

ì´ ê²½ìš° JdbcTemplateV3Config ë¥¼ import í•˜ê³ ìˆê¸° ë•Œë¬¸ì— 

```java
package hello.itemservice.config;

import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.jdbcTemplate.JdbcTemplateItemRepositoryV3;
import hello.itemservice.service.ItemService;
import hello.itemservice.service.ItemServiceV1;
import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.sql.DataSource;

@Configuration
@RequiredArgsConstructor
public class JdbcTemplateV3Config {

    private final DataSource dataSource;

    @Bean
    public ItemService itemService() {
        return new ItemServiceV1(itemRepository());
    }

    @Bean
    public ItemRepository itemRepository() {
        return new JdbcTemplateItemRepositoryV3(dataSource);

    }
}
```

ì´ ì„¤ì •ì„ ê¸°ë°˜ìœ¼ë¡œ Test ê°€ ì‘ë™ë˜ê²Œ ëœë‹¤.

### âœï¸Â Test ì „ìš© DB

### ğŸ“Â í•„ìš”ì„±

ì•ì—ì„œ ì„¤ëª…í•œëŒ€ë¡œ Test ë¥¼ ì‹¤í–‰í•  ê²½ìš° application ì—ì„œ ì‹¤í–‰í–ˆë˜ Data ë“¤ê³¼ ì„ì—¬ë²„ë ¤ ì •í™•í•œ test ê²€ì¦ì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆë‹¤.

find all ì„ ì˜ˆë¡œë“¤ë©´ ë‚´ê°€ Test ì—ì„œ ë“±ë¡í•œ Data ë§Œ ê²€ì¦ì„ ì›í–ˆì§€ë§Œ,
ë‹¤ë¥¸ Data ê°€ ì„ì—¬ë²„ë¦¬ë©´ ê²°ê³¼ê°€ ì‹¤íŒ¨ë¡œ ë‚˜ì˜¤ê³  ì •í™•í•œ ê²€ì¦ì„ í•  ìˆ˜ ì—†ë‹¤.

ê·¸ë ‡ë‹¤ê³  Test ë¥¼ ìœ„í•´ì„œ DB ë¥¼ ë¹„ì›Œë²„ë¦¬ë©´ DB ì— ì €ì¥ì„ í•´ë’€ë˜ data ê°€ ì—†ì–´ì§€ê²Œ ë˜ë¯€ë¡œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

```java
@Test
    void findItems() {
        //given
        Item item1 = new Item("itemA-1", 10000, 10);
        Item item2 = new Item("itemA-2", 20000, 20);
        Item item3 = new Item("itemB-1", 30000, 30);

        itemRepository.save(item1);
        itemRepository.save(item2);
        itemRepository.save(item3);

        //ë‘˜ ë‹¤ ì—†ìŒ ê²€ì¦
        test(null, null, item1, item2, item3);
        test("", null, item1, item2, item3);
```

### ğŸ“Â Test ì „ìš© DB ë¡œ ë¶„ë¦¬í•´ì„œ ë¬¸ì œ í•´ê²°

**ë°©ë²• 1. Test ìš© DB ë¥¼ ë”°ë¡œ ë§Œë“¤ì–´ application.yml ì— ì ‘ì† url ë³€ê²½**

[ğŸ”—Â H2 DB ìƒì„±í•˜ëŠ” ë°©ë²•](https://github.com/choideakook/TIL/blob/main/Spring/0%20Spring%20TIL/Intellij%20í”„ë¡œì íŠ¸%20ìƒì„±í›„%20ê¸°ë³¸%20ì„¸íŒ….md)

DB ë¥¼ ìƒì„±í•˜ê³  main Table ê³¼ ë™ì¼í•˜ê²Œ ìƒì„±í•´ì¤€ë‹¤.

```sql
drop table if exists item CASCADE;
     create table item
     (
         id        bigint generated by default as identity,
         item_name varchar(10),
         price     integer,
         quantity  integer,
         primary key (id)
     );
```

â—main DB ì™€ëŠ” ë³„ë„ì˜ DB ì—ì„œ Test ë¥¼ ì‹¤í–‰í–ˆìœ¼ë¯€ë¡œ Test ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ì§€ë§Œ,
Test ìš© Data ê°€ rollback ë˜ì§€ ì•Šì•„ì„œ ê°™ì€ test ë¥¼ ë°˜ë³µí•˜ë©´ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°ê°€ ìƒê¸´ë‹¤.