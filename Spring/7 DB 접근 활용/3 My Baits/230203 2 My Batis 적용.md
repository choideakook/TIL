# My Batis ì ìš©

## âœï¸Â My Batis ì ìš©í•˜ê¸°

### ğŸ“Â Repository

Repository ë¥¼ ë§Œë“¤ê¸° ì „ì— My Batis ëŠ” Interface ë¥¼ ë¨¼ì € ë§Œë“¤ì–´ì£¼ì–´ì•¼ í•œë‹¤.

```java
package hello.itemservice.repository.myBaits;

import hello.itemservice.domain.Item;
import hello.itemservice.repository.ItemSearchCond;
import hello.itemservice.repository.ItemUpdateDto;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;
import java.util.Optional;

// My batis ë§¤í•‘ XML ì„ í˜¸ì¶œí•´ì£¼ëŠ” ì–´ë…¸í…Œì´ì…˜
// My batis ê°€ ì¸ì‹ í•  ìˆ˜ ìˆê²Œëœë‹¤.
@Mapper 
public interface ItemMapper {

    // parameter ê°€ í•˜ë‚˜ì§€ë§Œ item ì˜ í•„ë“œê°’ì„ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
    void save(Item item);

    // parameter ê°€ 2ê°œ ì´ìƒì¼ ê²½ìš° @Param ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì£¼ì–´ì•¼ í•œë‹¤.
    void update(@Param("id") Long id, @Param("updateParam") ItemUpdateDto updateParam);

    Optional<Item> findById(Long id);

    List<Item> findAll(ItemSearchCond itemSearchCond);
}
```

ì´ë ‡ê²Œ ë§Œë“¤ì–´ì§„ method ëª…ê³¼ XML  íŒŒì¼ì˜ ê°™ì€ id ê°’ì´ ë§¤í•‘ë˜ê³  interface ë¥¼ í˜¸ì¶œí•˜ë©´ ë§¤í•‘ëœ XML ì˜ SQL ì„ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ ëŒë ¤ì¤€ë‹¤.

- xml íŒŒì¼ì€ Java íŒŒì¼ì´ ì•„ë‹ˆë¯€ë¡œ resource ë””ë ‰í† ë¦¬ì— ìƒì„±í•´ì•¼ í•œë‹¤.
    - java ì˜ interface ì™€ ë™ì¼í•œ ë””ë ‰í† ë¦¬ì— ë™ì¼í•œ íŒŒì¼ëª…ìœ¼ë¡œ ìƒì„±í•´ì£¼ì–´ì•¼ í•œë‹¤.
    - hello.itemservice.repository.myBaits.xml

```xml
<!-- xml ì„ ì‚¬ìš©í•œë‹¤ëŠ” ì„ ì–¸ -->
<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- xml ì‹œì‘  namespace ì™€ interface ë””ë ‰í† ë¦¬ë¥¼ ë§ì¶°ì£¼ì–´ì•¼ í•¨ -->
<mapper namespace="hello.itemservice.repository.myBaits.ItemMapper">

    <!-- save -->
    <!-- PK ëŠ” useGeneratedKeys ì™€ keyProperty ë¥¼ ì„¤ì •í•´ì¤Œ -->
    <insert id="save" useGeneratedKeys="true" keyProperty="id">
        insert into item (item_name, price, quantity)
        <!-- interface method ì˜ param ê°’ì¸ item ì˜ í•„ë“œê°’ì„ ì•Œì•„ì„œ get í•´ ë§¤í•‘í•¨ -->
        values (#{itemName}, #{price}, #{quantity})
    </insert>

    <!-- update -->
    <update id="update">
        update item
        set item_name=#{updateParam.itemName}, <!-- dto ì—ì„œ í•„ë“œê°’ì„ ì‚¬ìš©í•¨ -->
        price=#{updateParam.price},
        quantity=#{updateParam.quantity}
        where id = #{id}
    </update>

    <!-- findById -->
    <!-- resultType ì— entity ì¸ item ì˜ ë””ë ‰í† ë¦¬ ë¥¼ ì ì–´ì¤˜ì•¼ í•˜ì§€ë§Œ -->
    <!-- í™˜ê²½ì„¤ì •ì—ì„œ type-aliases-package: ë¥¼ ì„¤ì •í•´ì¤˜ì„œ ê°„ë‹¨í•˜ê²Œ Class ëª…ë§Œ ì ì–´ë„ ëœë‹¤ -->
    <select id="findById" resultType="Item">
        select id, item_name, price, quantity
        from item
        where id = #{id}
    </select>

    <!-- findAll -->
    <select id="findAll" resultType="Item">
        select id, item_name, price, quantity
        from item
        <!-- ë™ì  ì¿¼ë¦¬ -->
        <where>
            <if test="itemName != null and itemName != ''">
                and item_name like concat('%',#{itemName},'%')
            </if>
            <if test="maxPrice != null">
                and price &lt;= #{maxPrice}
            </if>
        </where>
    </select>

</mapper>
```

<br>

ì´ì œ repository ë¥¼ ë§Œë“¤ë©´ ëœë‹¤.

- Interface ì¸ ItemRepository ë¥¼ ìƒì†í•˜ê³  Item Mapper ë¥¼ ì˜ì¡´í•œë‹¤.
- ë‹¨ìˆœí•˜ê²Œ item mapper ì—ì„œ í•´ë‹¹ method ë¥¼ í˜¸ì¶œí•´ override mehtod ì— ì…ë ¥í•´ì£¼ë©´ ëœë‹¤.

```java
package hello.itemservice.repository.myBaits;

import hello.itemservice.domain.Item;
import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.ItemSearchCond;
import hello.itemservice.repository.ItemUpdateDto;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;

@Repository
@RequiredArgsConstructor
public class MyBatisItemRepository implements ItemRepository {

    // ItemMapper ë¥¼ ì£¼ì… ë°›ëŠ”ë‹¤.
    private final ItemMapper itemMapper;

    // êµ¬í˜„ì²´ ë¡œì§ ë§Œë“¤ê¸°
    // ë‹¨ìˆœí•˜ê²Œ ìœ„ì„í•˜ëŠ” ê¸°ëŠ¥ë§Œ í•˜ê²Œëœë‹¤.
    @Override
    public Item save(Item item) {
        itemMapper.save(item);
        return item;
    }

    @Override
    public void update(Long itemId, ItemUpdateDto updateParam) {
        itemMapper.update(itemId, updateParam);
    }

    @Override
    public Optional<Item> findById(Long id) {
        return itemMapper.findById(id);
    }

    @Override
    public List<Item> findAll(ItemSearchCond cond) {
        return itemMapper.findAll(cond);
    }
}
```

<br>

### ğŸ“Â config ì—°ê²°

- DataSource ëŒ€ì‹  ItemMapper ë¥¼ ì£¼ì…ì‹œì¼œì¤€ë‹¤.
    - MyBatis ëª¨ë“ˆì´ ItemMapper ì™€  DataSource, transaction ë¥¼ ì—°ê²°ì‹œì¼œì¤Œ

```java
package hello.itemservice.config;

import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.jdbcTemplate.JdbcTemplateItemRepositoryV3;
import hello.itemservice.repository.myBaits.ItemMapper;
import hello.itemservice.repository.myBaits.MyBatisItemRepository;
import hello.itemservice.service.ItemService;
import hello.itemservice.service.ItemServiceV1;
import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.sql.DataSource;

@Configuration
@RequiredArgsConstructor
public class MyBatisConfig {

    // data source ëŠ” MyBatis ëª¨ë“ˆì´ ItemMapper ì™€ ì—°ê²°ì‹œì¼œì¤Œ
    // data source ë¿ ì•„ë‹ˆë¼ transaction ê¹Œì§€ ì—°ê²°í•´ì¤€ë‹¤.
//    private final DataSource dataSource;
    private final ItemMapper itemMapper;

    @Bean
    public ItemService itemService() {
        return new ItemServiceV1(itemRepository());
    }

    @Bean
    public ItemRepository itemRepository() {
        return new MyBatisItemRepository(itemMapper);

    }
}
```

<br>

### ğŸ“Â application import ë³€ê²½

- ë°©ê¸ˆ ë§Œë“  config ë¡œ ìˆ˜ì •í•´ì¤Œ

```java
@Slf4j
@Import(MyBatisConfig.class)
@SpringBootApplication(scanBasePackages = "hello.itemservice.web")
public class ItemServiceApplication {

	public static void main(String[] args) {
		SpringApplication.run(ItemServiceApplication.class, args);
	}
```

<br>

ì´ëŒ€ë¡œ Test ë¥¼ ì‹¤í–‰í•˜ë©´ ì •ìƒì ìœ¼ë¡œ ì‘ë™ë˜ê³  web application ì—ì„œë„ ì˜ ì‘ë™ëœë‹¤.