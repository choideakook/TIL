# JPA ì—°ê²° ë°©ë²•

## âœï¸Â 0 . JPA ë°©ì‹ì˜ íŠ¹ì§•

- ê¸°ì¡´ì˜ ë°˜ë³µ ë˜ëŠ” ì½”ë“œì˜ ì¤‘ë³µ ì œê±° ë¿ ì•„ë‹ˆë¼ SQL ë„ ì§ì ‘ ë§Œë“¤ì–´ ì‹¤í–‰í•´ì¤€ë‹¤.
- jpa ë¥¼ ì‚¬ìš©í•  ê²½ìš° SQL ê³¼ ë°ì´í„° ì¤‘ì‹¬ì˜ ì„¤ê³„ì—ì„œ ê°ì²´ ì¤‘ì‹¬ì˜ ì„¤ê³„ë¡œ íŒ¨í„°ë‹¤ì„ì„ ì „í™˜ í•  ìˆ˜ ìˆë‹¤.
- ê°œë°œ ìƒì‚°ì„±ì„ í¬ê²Œ ë†’ì¼ ìˆ˜ ìˆë‹¤.
- jpa ëŠ” ê°ì²´ì™€ ORM ê¸°ìˆ ì´ í•©ì²˜ì§„ ê¸°ìˆ ì´ë‹¤.
    - ê°ì²´ì™€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë§µí•‘í•œë‹¤ëŠ” ì˜ë¯¸

## âœï¸Â 1. í™˜ê²½ì„¤ì •

- build.gradle â†’ `dependencies` ë””íœë˜ì‹œì— ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€

```java
implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
```

- ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€

```java
spring.jpa.show-sql=true
spring.jpa.hibernate.ddl-auto=none
```

1. spring.jpa.show-sql=true : jpa ê°€ ì‘ì„±í•˜ëŠ” sql ë¬¸ì„ í™•ì¸í•  ìˆ˜ ìˆìŒ
2. hibernate.ddl-auto=none : jpa ê°€ ìë™ìœ¼ë¡œ tableì„ ë§Œë“¤ì§€ ì•Šê²Œ í•¨
    
    (ğŸ’¡ë³´í†µ create ë¡œ ì¼œë†“ëŠ”ê²Œ í¸í•˜ì§€ë§Œ í•™ìŠµì„ ìœ„í•´ êº¼ë‘ )
    

### ğŸš¨Â ì¤‘ê°„ ì •ê²€

ë¼ì´ë¸Œ ëŸ¬ë¦¬ì— jpa ì™€ hibernate íŒŒì¼ì´ ë‹´ê²¨ìˆì–´ì•¼ í•¨

- jpa : ì‹¤ì§ˆì ìœ¼ë¡œ ì¸í„°í˜ì´ìŠ¤ë§Œ ì œê³µë¨
- hibernate : ì‹¤ì§ˆì ì¸ êµ¬í˜„ì„ ë‹´ë‹¹

## âœï¸Â 2. Member Mapping

Member class ì— jpa ê°€ ì¸ì‹í•  ìˆ˜ ìˆê²Œ ì–´ë…¸í…Œì´ì…˜ì„ ë„£ì–´ì¤Œ

```java
@Entity   // <- jpa ê°€ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹° ë¼ëŠ” ëœ»
public class Member {
```

PK ë§µí•‘ : identity ì „ëµ

ğŸ“Â table ë‚´ row ë¥¼ ìƒì„±í•  ê²½ìš° ìë™ìœ¼ë¡œ ê³ ìœ  ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ëŠ” ê¸°ëŠ¥ (í˜„ project ì—ì„œëŠ” Id)

```java
@Id @GeneratedValue (strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;
		...
```

âš ï¸Â ë§Œì•½ sqlì— ìƒì„±ë˜ëŠ” column ëª…ì„ ë³€ê²½í•˜ê³  ì‹¶ì„ ë• @Column ìœ¼ë¡œ ë³€ê²½í•´ì£¼ë©´ëœë‹¤.

```java
// name -> username
@Coulmn (name = "username")
private String name;
```

## âœï¸Â 3. Transactional

ğŸ“DB ì— ì €ì¥ëœ ë‚´ìš©ì„ ë³€ê²½í•˜ê±°ë‚˜ ì¶”ê°€, ì‚­ì œí•  ê²½ìš° Transcational ì„ ê¼­ í•´ì£¼ì–´ì•¼ í•¨

í˜„ì¬ project ì—ëŠ” save ê¸°ëŠ¥ë§Œ DB ë¥¼ ë³€ê²½ì‹œí‚¬ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— Service Class ì˜ join Method ì—ë§Œ í•´ì¤˜ë„ ë˜ê³ ,

```java
		/**
     * íšŒì› ê°€ì… (ì¤‘ë³µíšŒì› ë°©ì§€)
     */
    @Transactional
    public Long join (Member member){

        validateDuplicateMember(member);

        memberRepository.save(member);
        return member.getId();
    }
```

Member Service Class ì „ì²´ì— í•´ì£¼ì–´ë„ ë¬´ë°©í•˜ë‹¤.

```java
// class ì „ì²´ì— transactional
@Transactional
public class MemberService {
```

## âœï¸Â 4. Repositoy ìƒì„± (Entity Manager Injection)

- Member repository ë¥¼ implements í•˜ëŠ” class ë¥¼ ìƒì„±í•œë‹¤.
    
    ğŸ“method ìë™ ì‘ì„±ì€ O + E
    
- JPA ì˜ ëª¨ë“  ì‘ì—…ì„ ë™ì‘ì‹œí‚¬ ìˆ˜ ìˆëŠ” Class ì¸ Entity manager ë¥¼ DI í•œë‹¤

```java
public class JpaMemberRepositoy implements MemberRepository{

		// DI
   private final EntityManager em;

    public JpaMemberRepositoy(EntityManager em) {
        this.em = em;
    }
```

ğŸ’¡ì‘ë™ ì›ë¦¬

1. build.gradle ì—ì„œ ë¡œë“œí•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ Spring Boot ê°€ ìë™ìœ¼ë¡œ Entity manager ë¥¼ ìƒì„±í•¨
2. repository ì—ì„œ ìƒì„±ëœ Entity manager ë¥¼ ì¸ì ì…˜ ì‹œì¼œì¤Œ

## âœï¸Â 5. Repositoy ì„¸ë¶€ ì½”ë“œ ì‘ì„±

- Save

```java
@Override
    public Member save(Member member) {
        em.persist(member);
        return member;
    }
```

- Find by Id

```java
@Override
    public Optional<Member> findById(Long id) {
        Member member = em.find(Member.class, id);
        return Optional.ofNullable(member);
    }
```

- Find by name (2ê°œ ì´ìƒì˜ dater ë¥¼ ì°¾ì•„ì•¼ í•  ê²½ìš°ì—ëŠ” (pk ê¸°ë°˜ì´ ì•„ë‹Œ ê²½ìš°) JPQL ì„ ì‘ì„±í•´ ì£¼ì–´ì•¼ í•¨

```java
@Override
    public Optional<Member> findByName(String name) {
        List<Member> result = em.createQuery(
                "Select m from Member m where m.name = :name", Member.class
                )
                .setParameter("name", name)
                .getResultList();
        return result.stream().findAny();
    }
```

- Find All (ë§ˆì°¬ê°€ì§€ë¡œ JPQL ì‘ì„± í•„ìš”)

```java
@Override
    public List<Member> findAll() {
        return em.createQuery("select m from Member m", Member.class)
                .getResultList();
    }
```

## âœï¸Â 6.  Config

- jdbc ê¸°ë°˜ ì—°ê²°ì‹œ ì‚¬ìš©í• ë•Œ ì‚¬ìš©í•œ DataSource Class ì²˜ëŸ¼ JPA ì—°ê²°ë°©ì‹ì— ì‚¬ìš©í•œ Entity Manager ë¥¼ ì£¼ì…ì‹œì¼œì¤Œ

```java
// entity manager ìƒì„±
private EntityManager em;

    @Autowired
    public SpringConfig(EntityManager em) {
        this.em = em;
    }
```

```java
// ë¦¬í¬ì§€í† ë¦¬ ì»¨í”¼ê·¸
@Bean
    public MemberRepository memberRepository(){

//        return new MemoryMemberRepository();
//        return new JdbcMemberRepositoy(dataSource);
//        return new JdbcTemplateMemberRepository(dataSource);
        return new JpaMemberRepositoy(em);
    }
```

## ğŸ’¡Â Entity Manager ì˜ Method ì™€ ê¸°ëŠ¥ë“¤

- persist()
- createQuery()
- find()
- setParameter
- getResultList()
- 

[List.stream](http://List.stream)()

List.findAny()