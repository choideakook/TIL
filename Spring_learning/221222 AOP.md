# AOP

## âœï¸Â AOP ê°€ í•„ìš”í•œ ìƒí™©

1. ëª¨ë“  ë©”ì†Œë“œì˜ í˜¸ì¶œ ì‹œê°„ì„ ì¸¡ì •í•˜ê³  ì‹¶ì€ ê²½ìš°
2. ê³µí†µ ê´€ì‹¬ ì‚¬í•­ (cross-concern) vs í•µì‹¬ ê´€ì‹¬ ì‚¬í•­ (core concern)
3. íšŒì› ê°€ì… ì‹œê°„, íšŒì› ì¡°íšŒ ì‹œê°„ì„ ì¸¡ì •í•˜ê³  ì‹¶ì€ ê²½ìš°

---

## âœï¸ AOP ì—†ì´ ê¸°ë³¸ì ì¸ í˜¸ì¶œ ì‹œê°„ì„ ì¸¡ì •í•˜ëŠ” ë°©ë²•

- service ì˜ join ìœ¼ë¡œ ë§Œë“¤ì–´ë´¤ìŒ

```java
public Long join (Member member){
	// ì‹œì‘ ì‹œê°„ ì¸¡ì •
	long start = System.currentTimeMillis();

	try{
		// ì›ë˜ join method ì‹¤í–‰
		validateDuplicateMember(member);
		memberRepository.save(member);
		return member.getId();

	} finally {
		// ëë‚˜ëŠ” ì‹œê°„ ì¸¡ì •
		long finish = System.currentTimeMillis();
		// ì‹¤í–‰ëœ ì‹œê°„ ì¸¡ì • (ëë‚œ - ì‹œì‘ ì‹œê°„)
		Long timeMs = finish - start;
		// ì¶œë ¥
		System.out.println("join = " + timeMs + "ms");
	}
}
```

â—ï¸ë¬¸ì œì  

- ëª¨ë“  method ì— ëŒ€í•´ì„œ ì‹¤í–‰í•˜ê²Œ ë ê²½ìš° í”„ë¡œì íŠ¸ì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  method ì— ì‹œê°„ ì¸¡ì • ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•œë‹¤.
- ë§Œì•½ ìˆ˜ì •ì´ í•„ìš”í•  ê²½ìš° ëª¨ë“  method ë¥¼ í•˜ë‚˜ í•˜ë‚˜ ìˆ˜ì •í•´ì•¼í•œë‹¤.
- ì‹œê°„ì¸¡ì • ë¡œì§ì€ í•µì‹¬ ë¡œì§ì´ ì•„ë‹Œ ë¶€ê°€ì ì¸ ê³µí†µ ê´€ì‹¬ ë¡œì§ì¸ë° ì´ê²ƒ ë•Œë¬¸ì— ì½”ë“œì˜ ê°€ë…ì„±ì´ ë–¨ì–´ì§€ê³  ìœ ì§€ë³´ìˆ˜ ë˜í•œ ì–´ë µê²Œ ëœë‹¤.

### ğŸ” ê³µí†µ ê´€ì‹¬ ì‚¬í•­ (cross-concern) vs í•µì‹¬ ê´€ì‹¬ ì‚¬í•­ (core concern)

- í•µì‹¬ ê´€ì‹¬ ì‚¬í•­ : method ì— ì—†ì–´ì„œëŠ” ì•ˆë  í•µì‹¬ì ì¸ ì—­í• ì„ í•˜ëŠ” ë¡œì§
- ê³µí†µ ê´€ì‹¬ ì‚¬í•­ : íŠ¹ì • method ì— ë¡œì§ì´ ì—†ì–´ë„ ê¸°ëŠ¥ì ìœ¼ë¡œ ì•„ë¬´ ë¬¸ì œ ì—†ì§€ë§Œ ë¶€ê°€ì ì¸ ì •ë³´ë¥¼ ìœ„í•´ ì—¬ëŸ¬ê°œì˜ method ë“¤ì—ê²Œ ê³µí†µì ìœ¼ë¡œ í¬í•¨ì‹œì¼œì•¼ í•˜ëŠ” ë¡œì§

---

## âœï¸Â AOP ì ìš©

### ğŸ”Â ì ìš© ì›ë¦¬

ê³µí†µ ê´‘ì‹¬ ë¡œì§ì„ ë”°ë¡œ ë¹¼ í•œêµ°ë°ì— ì •ë¦¬í•´ë‘” í›„ ì›í•˜ëŠ”ê³³ì— ì ìš©í•˜ëŠ” ë°©ì‹

- aop ì ìš©ì „ ì‘ë™ ê³¼ì •
    - ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ : Controller -ì˜ì¡´ê´€ê³„â†’ Service
- aop ì ìš© í›„ ì‘ë™ ê³¼ì •
    - ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ : Controller â†’ í”„ë¡ì‹œ Service (ë³µì‚¬ë³¸) -joinPoint.proceedâ†’ ì§„ì§œ Service

### âœï¸Â 1.  AOP Class ìƒì„± / ì½”ë“œ ì‘ì„±

- AOP ëŠ” @Aspect ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì¤˜ì•¼ ì¸ì‹ì´ ê°€ëŠ¥í•˜ë‹¤.

```java
package hello.hellospring.aop;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Aspect;

import java.util.Objects;

@Aspect
public class TimeTraceAop {

		public Objects execute(ProceedingJoinPoint joinPoint) throws Throwable {
        // ì‹œê°„ ì¸¡ì • ë¡œì§ ì‘ì„±
				long start = System.currentTimeMillis();
        System.out.println("Start = " + joinPoint.toString());
        try {
            // ë‹¤ìŒ method ë¡œ ì§„í–‰í•˜ê²Œ í•´ì£¼ëŠ” method
						return (Objects) joinPoint.proceed();
        } finally {
            long finish = System.currentTimeMillis();
            Long timeMs = finish - start;
            System.out.println(
                    "End = " + joinPoint.toString() + " " + timeMs + "ms"
            );
        }
    }
}
```

- ProceedingJoinPoint.toString : ì‹œê°„ ì¸¡ì •ì„ í•œ method ì´ë¦„ì„ get í•˜ëŠ” ê¸°ëŠ¥
- ProceedingJoinPoint.proceed : ë‹¤ìŒ method ë¡œ ì§„í–‰í•˜ê²Œ í•´ì£¼ëŠ” ê¸°ëŠ¥

### âœï¸Â 2.  config ë“±ë¡

- ìë™ìœ¼ë¡œ ì• ë…¸í…Œì´ì…˜ ë“±ë¡ ë°©ë²•

Class ëª…ì— `@Component` ì…ë ¥

```java
@Aspect
@Component
public class TimeTraceAop {

    public Objects execute(ProceedingJoinPoint joinPoint) throws Throwable {
	        long start = System.currentTimeMillis();
					...
```

  

- ìˆ˜ë™ìœ¼ë¡œ ì§ì ‘ Bean ë“±ë¡

config í´ë ˆìŠ¤ì— ìƒˆë¡œìš´ @ban ë“±ë¡

```java
@Bean
public TimeTraceAop timeTraceAop (){
		return new TimeTraceAop();
}
```

### âœï¸Â 3. íƒ€ê²ŸíŒ… ì„¤ì •

- AOP ë¥¼ ì–¸ì œ ì‘ë™ì‹œí‚¬ ìˆ˜ ìˆê²Œ í• ê²ƒì¸ê°€?

```java
@Around()  //<- íƒ€ê²ŸíŒ… ì„¤ì •ê¸°ëŠ¥ (ê´„í˜¸ì•ˆì— íƒ€ê²Ÿì„ ì…ë µí•œë‹¤)
public Objects execute(ProceedingJoinPoint joinPoint) throws Throwable {
     long start = System.currentTimeMillis();
     System.out.println("Start = " + joinPoint.toString());
        ...
```

- íƒ€ê²Ÿì˜ ìœ„ì¹˜ë¥¼ ì ì–´ì¤Œ
    - hello.hellospring â†’ íŒ¨í‚¤ì§€ ëª…
    - .. â†’ í´ë ˆìŠ¤ëª… (ì „ë¶€ë‹¤ ì‘ë™)
    - (..) â†’ íŒŒë¼ë¯¸í„° íƒ€ì… (ì „ë¶€ë‹¤)

```java
@Around("execution(* hello.hellospring..*(..))")
public Objects execute(ProceedingJoinPoint joinPoint) throws Throwable {
     long start = System.currentTimeMillis();
     System.out.println("Start = " + joinPoint.toString());
        ...
```